<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Philippe Vanden Eeckaut">
<meta name="description" content="Entrées et sorties dans R">

<title>Analyse des données</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Import_files/libs/clipboard/clipboard.min.js"></script>
<script src="Import_files/libs/quarto-html/quarto.js"></script>
<script src="Import_files/libs/quarto-html/popper.min.js"></script>
<script src="Import_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Import_files/libs/quarto-html/anchor.min.js"></script>
<link href="Import_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Import_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Import_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Import_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Import_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Autres formats</h2><ul><li><a href="Import.pdf"><i class="bi bi-file-pdf"></i>Typst</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Analyse des données</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Montrer tout le code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Cacher tout le code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Voir les sources</a></li></ul></div></div>
<p class="subtitle lead">1. Importation/Exportation (IO)</p>
</div>

<div>
  <div class="description">
    Entrées et sorties dans R
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Auteur·rice</div>
    <div class="quarto-title-meta-contents">
             <p>Philippe Vanden Eeckaut </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Date de publication</div>
    <div class="quarto-title-meta-contents">
      <p class="date">15 août 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!--# Spécification des options -->
<section id="importationexportation-io" class="level1">
<h1>Importation/Exportation (IO)</h1>
<section id="principes" class="level2">
<h2 class="anchored" data-anchor-id="principes">Principes</h2>
<p>La lecture de données se réalise de diverses manières:</p>
<ul>
<li>Données internes de R (importation)
<ul>
<li>Depuis les packages.</li>
</ul></li>
<li>Données externes de R (importation/exportation)
<ul>
<li>Données compressées
<ul>
<li>Format propriétaire de R (.rda/.rds)</li>
<li>Format ouvert (.feather/.parquet)</li>
</ul></li>
<li>Données au format texte</li>
<li>Fichiers textes formatés (.csv)</li>
<li>Données au format d’autres applications</li>
<li>Fichiers de tableurs (.xls,.xlsx)</li>
<li>fichiers statistiques (sas,spss,….=)</li>
</ul></li>
</ul>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>On va à partir de cette session utiliser des <strong><em>packages</em></strong>. Pour utiliser un package deux opérations sont nécessaires:</p>
<ul>
<li><p><em>Installer le package</em>:</p>
<ul>
<li>La première opération consiste à récupérer le package sur un serveur. Un serveur est toujours utilisé par défaut dans Rstudio.</li>
<li>Pour vérifier le serveur utilisé il faut aller voir la section package dans les préférence de Rstudio.</li>
<li>L’installation d’un package se fait soit par l’intetface de Rstudio soit dans la fenêtre ‘sud est’ de Rstudio et l’onglet package avec Install soit par l’instruction <code>install.packages()</code>. Il sera alors présent sur la machine (il est disponible dans la liste de la fenêtre package de Rstudio)</li>
</ul></li>
<li><p><em>Charger le package</em>:</p>
<ul>
<li>Pour utiliser le package durant une session de Rstudio il est nécessaire de charger le package par la commande <code>library()</code>.</li>
<li>Dans la fenêtre <code>sud-est</code> à l’onglet <code>Packages</code> on dispose de la liste des packages disponible sur la machine et ceux chargés seront cochés. (Certains packages sont toujoutrs disponibles: base,datasets,datasets,grDevices,methods,utils )</li>
</ul></li>
</ul>
<p>Pour simplifier l’ensemble du processus, il est plus facile réaliser les deux opérations en une fois avec les instructions ci-dessous</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Mes_packages <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'rio'</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'openxlsx'</span>,<span class="st">'readxl'</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'feather'</span>,<span class="st">'arrow'</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'data.table'</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'here'</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'rbenchmark'</span>,<span class="st">'fakir'</span>)        </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des packages nécessaires</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> Mes_packages){                                  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(p,<span class="at">character.only =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(p,<span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)       </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># si le package est absent on l'installe</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(p,<span class="at">character.only =</span> <span class="cn">TRUE</span>)                              </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On charge ensuite tous les packages</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="données-internes" class="level2">
<h2 class="anchored" data-anchor-id="données-internes">Données internes</h2>
<p>La manière la plus simple est de lire les données incluses directement dans un package. Au départ une ensemble de packages est déjà chargé dans Rstudio. Ainsi par exemple, nous avons le package <code>datasets</code>qui comporte de nombreuses données qui sont visible avec la fonction `data()’</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">data</span>(<span class="at">package=</span><span class="st">"datasets"</span>)  <span class="co"># Lecture de la liste</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataset<span class="sc">$</span>results[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])          <span class="co"># Affichage des 6 premiers</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;      Item                     Title                                           
&gt; [1,] "AirPassengers"          "Monthly Airline Passenger Numbers 1949-1960"   
&gt; [2,] "BJsales"                "Sales Data with Leading Indicator"             
&gt; [3,] "BJsales.lead (BJsales)" "Sales Data with Leading Indicator"             
&gt; [4,] "BOD"                    "Biochemical Oxygen Demand"                     
&gt; [5,] "CO2"                    "Carbon Dioxide Uptake in Grass Plants"         
&gt; [6,] "ChickWeight"            "Weight versus age of chicks on different diets"</code></pre>
</div>
</div>
<p>Si nous avons besoin de données présentes dans un package précis, il est nécessaire de le charger au préalable.</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"plm"</span>,<span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 
&gt; The downloaded binary packages are in
&gt;   /var/folders/gw/b5_9kkkx3k7949g_gnhs0nkr0000gn/T//RtmpTONChE/downloaded_packages</code></pre>
</div>
</div>
<p>Par la même commande <code>data(package=&lt;package&gt;)</code> il est possible de visualiser les données de ce package. Les données sont visibles uniquement dans une fenêtre de Rstudio.</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="at">package=</span><span class="st">"plm"</span>)  <span class="co"># Liste des données disponibles</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre><code>Data sets in package ‘plm’:

Cigar                 Cigarette Consumption
Crime                 Crime in North Carolina
EmplUK                Employment and Wages in the United Kingdom
Gasoline              Gasoline Consumption
Grunfeld              Grunfeld's Investment Data
Hedonic               Hedonic Prices of Census Tracts in the
                      Boston Area
LaborSupply           Wages and Hours Worked
Males                 Wages and Education of Young Males
Parity                Purchasing Power Parity and other parity
                      relationships
Produc                US States Production
RiceFarms             Production of Rice in Indonesia
Snmesp                Employment and Wages in Spain
SumHes                The Penn World Table, v. 5
Wages                 Panel Data of Individual Wages</code></pre>
<p>Pour nos besoins nous utiliserons l’ensemble de données “Wages”. Ces données regroupent des informations sur une cohorte de 595 personnes qui sont collectées aux Etats Unis annuellement entre 1976 et 1982 soit 4165 observations.</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Wages,<span class="at">package=</span><span class="st">"plm"</span>) <span class="co"># Lecture du fichier "Wages"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Wages,<span class="at">n=</span><span class="dv">7</span>)           <span class="co"># Affichage des 6 premières lignes</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   exp wks bluecol ind south smsa married  sex union ed black   lwage
&gt; 1   3  32      no   0   yes   no     yes male    no  9    no 5.56068
&gt; 2   4  43      no   0   yes   no     yes male    no  9    no 5.72031
&gt; 3   5  40      no   0   yes   no     yes male    no  9    no 5.99645
&gt; 4   6  39      no   0   yes   no     yes male    no  9    no 5.99645
&gt; 5   7  42      no   1   yes   no     yes male    no  9    no 6.06146
&gt; 6   8  35      no   1   yes   no     yes male    no  9    no 6.17379
&gt; 7   9  32      no   1   yes   no     yes male    no  9    no 6.24417</code></pre>
</div>
</div>
<p>Une fois les données lues, il est utile de connaitre la description de ces données. Une possibilité est d’aller dans l’aide de R et d’afficher les informations disponibles:</p>
<pre><code>Wages {plm} R Documentation
Panel Data of Individual Wages
Description
A panel of 595 individuals from 1976 to 1982, taken from the Panel Study of Income Dynamics (PSID).

The data are organized as a stacked time series/balanced panel, see Examples on how to convert to a pdata.frame.

Format
A data frame containing:

exp       years of full-time work experience.
wks       weeks worked.
bluecol   blue collar?
ind       works in a manufacturing industry?
south     resides in the south?
smsa      resides in a standard metropolitan statistical area?
married   married?
sex       a factor with levels "male" and "female"
union     individual's wage set by a union contract?
ed        years of education.
black     is the individual black?
lwage     logarithm of wage.

Details
total number of observations : 4165

observation : individuals

country : United States

Source
Online complements to Baltagi (2001):

https://www.wiley.com/legacy/wileychi/baltagi/

Online complements to Baltagi (2013):

https://bcs.wiley.com/he-bcs/Books?action=resource&amp;bcsId=4338&amp;itemId=1118672321&amp;resourceId=13452

References
Baltagi BH (2001). Econometric Analysis of Panel Data, 3rd edition. John Wiley and Sons ltd.

Baltagi BH (2013). Econometric Analysis of Panel Data, 5th edition. John Wiley and Sons ltd.

Cornwell C, Rupert P (1988). “Efficient Estimation With Panel Data: an Empirical Comparison of Instrumental Variables Estimators.” Journal of Applied Econometrics, 3, 149–155.

Examples
Run examples

# data set 'Wages' is organized as a stacked time series/balanced panel
data("Wages", package = "plm")
Wag &lt;- pdata.frame(Wages, index=595)</code></pre>
<p>Il est ensuite possible de régarder la description de ces données par l’instruction <code>str()</code></p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages)            <span class="co"># Affichage de la description</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 4165 obs. of  12 variables:
&gt;  $ exp    : int  3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ wks    : int  32 43 40 39 42 35 32 34 27 33 ...
&gt;  $ bluecol: Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 2 2 2 ...
&gt;  $ ind    : int  0 0 0 0 1 1 1 0 0 1 ...
&gt;  $ south  : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 1 1 1 ...
&gt;  $ smsa   : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ married: Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
&gt;  $ sex    : Factor w/ 2 levels "male","female": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ union  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 2 ...
&gt;  $ ed     : int  9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ black  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ lwage  : num  5.56 5.72 6 6 6.06 ...</code></pre>
</div>
</div>
<p>Nous allons regarder plus spécifiquement les variables suivantes:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>type</th>
<th>Définition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>exp</td>
<td>int</td>
<td>années d’expériences (plein temps)</td>
</tr>
<tr class="even">
<td>bluecol</td>
<td>Factor</td>
<td>ouvrier ? (yes,no)</td>
</tr>
<tr class="odd">
<td>sex</td>
<td>Factor</td>
<td>sexe ? (male,female)</td>
</tr>
<tr class="even">
<td>ed</td>
<td>int</td>
<td>années d’étude</td>
</tr>
<tr class="odd">
<td>lwage</td>
<td>num</td>
<td>log du salaire</td>
</tr>
</tbody>
</table>
<section id="exercice" class="level3">
<h3 class="anchored" data-anchor-id="exercice">Exercice</h3>
<p>Nous allons sélectionner un sous-ensemble des 100 ouvriers avec plus de 10 ans pour l’expérience et moins de 10 ans pour les études en 1980 et classer le résultat selon le salaire décroissant.La table contiendra les variables suivante: id,sex,exp,ed,lwage.</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Obtenir les informations manquantes</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    -----------------------------------</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Technique manuelle basée sur rep()</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Wages,<span class="dv">7</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   exp wks bluecol ind south smsa married  sex union ed black   lwage
&gt; 1   3  32      no   0   yes   no     yes male    no  9    no 5.56068
&gt; 2   4  43      no   0   yes   no     yes male    no  9    no 5.72031
&gt; 3   5  40      no   0   yes   no     yes male    no  9    no 5.99645
&gt; 4   6  39      no   0   yes   no     yes male    no  9    no 5.99645
&gt; 5   7  42      no   1   yes   no     yes male    no  9    no 6.06146
&gt; 6   8  35      no   1   yes   no     yes male    no  9    no 6.17379
&gt; 7   9  32      no   1   yes   no     yes male    no  9    no 6.24417</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Wages_p <span class="ot">&lt;-</span> Wages</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Wages_p<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),<span class="dv">595</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>Wages_p<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">595</span>,<span class="at">each=</span><span class="dv">7</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Réaliser le filtre</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    ------------------</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>Wages_s <span class="ot">&lt;-</span> <span class="fu">subset</span>(Wages_p, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                  bluecol <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">&amp;</span> exp <span class="sc">&gt;=</span><span class="dv">10</span> <span class="sc">&amp;</span> ed <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> time<span class="sc">==</span><span class="dv">5</span> , </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">select =</span> <span class="fu">c</span>(id,sex,exp,ed,lwage))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>Wages_s <span class="ot">&lt;-</span> <span class="fu">head</span>(Wages_s[<span class="fu">order</span>(Wages_s<span class="sc">$</span>lwage,<span class="at">decreasing=</span><span class="cn">TRUE</span>),],<span class="dv">25</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages_s)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 25 obs. of  5 variables:
&gt;  $ id   : int  496 224 486 55 269 123 65 435 367 91 ...
&gt;  $ sex  : Factor w/ 2 levels "male","female": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ exp  : int  37 38 36 36 25 31 34 17 29 14 ...
&gt;  $ ed   : int  8 5 9 8 9 8 8 9 9 7 ...
&gt;  $ lwage: num  7.39 7.12 7.09 7.04 7 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Wages_s</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;       id  sex exp ed   lwage
&gt; 3470 496 male  37  8 7.39080
&gt; 1566 224 male  38  5 7.12287
&gt; 3400 486 male  36  9 7.09008
&gt; 383   55 male  36  8 7.04141
&gt; 1881 269 male  25  9 7.00307
&gt; 859  123 male  31  8 6.93925
&gt; 453   65 male  34  8 6.93828
&gt; 3043 435 male  17  9 6.93245
&gt; 2567 367 male  29  9 6.88244
&gt; 635   91 male  14  7 6.85646
&gt; 824  118 male  29  9 6.85646
&gt; 915  131 male  34  8 6.85646
&gt; 1468 210 male  38  8 6.85646
&gt; 1426 204 male  36  9 6.80239
&gt; 1937 277 male  37  8 6.80239
&gt; 2791 399 male  35  6 6.77194
&gt; 4135 591 male  38  8 6.77079
&gt; 2651 379 male  26  7 6.73934
&gt; 1328 190 male  10  9 6.71901
&gt; 2455 351 male  27  8 6.69703
&gt; 460   66 male  24  8 6.68711
&gt; 1370 196 male  11  9 6.68461
&gt; 1713 245 male  40  7 6.66568
&gt; 2238 320 male  24  6 6.59578
&gt; 2070 296 male  34  8 6.59167</code></pre>
</div>
</div>
</section>
</section>
<section id="données-externes" class="level2">
<h2 class="anchored" data-anchor-id="données-externes">Données externes</h2>
<p>L’activité la plus régulière en cas d’analyse de données sera de lire et d’écrire des données de ou vers des ressources extérieures à R. Il existe de très nombreux formats possibles. Dans le cadre de ce cours nous allons insister sur les catégories suivantes</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Format</th>
<th>Caractéristiques</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Compressées R</td>
<td>I/O uniquement par R</td>
<td>.RData .rda</td>
</tr>
<tr class="even">
<td>Compressées</td>
<td>I/O universel</td>
<td>.parquer .feather</td>
</tr>
<tr class="odd">
<td>Textes</td>
<td>I/O universel</td>
<td>.csv,…</td>
</tr>
<tr class="even">
<td>Spécifiques</td>
<td>I/O spécifique</td>
<td>.xlsx,…</td>
</tr>
</tbody>
</table>
<p>De nombreux packages sont nécessaires pour convertir les différents formats possibles. Un package <code>rio</code> regroupe tous ces packages sous une interface commune</p>
<section id="données-compressés" class="level3">
<h3 class="anchored" data-anchor-id="données-compressés">Données Compressés</h3>
<p>Afin de gagner en efficacité, les données peuvent etre compressés selon un algorithme choisi (zip,…). Nous allons distinguer deux possibiliés, soit les données sont lisibles uniquement par le créateur des données (dans notre cas R), soit les données sont lisibles de manière universelle par un format reconnu nativement au m</p>
<section id="fichiers-propriétaires-r-.rdata.rda" class="level4">
<h4 class="anchored" data-anchor-id="fichiers-propriétaires-r-.rdata.rda">Fichiers propriétaires R: .RData,.rda</h4>
<p>Nous examinerons les fichiers suivants:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Format</th>
<th>Extension</th>
<th>Importation (Package)</th>
<th>Exportation (Package)</th>
<th>rio ?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R objects (global)</td>
<td>.RData, .rda</td>
<td><strong>base</strong></td>
<td><strong>base</strong></td>
<td>Présent</td>
</tr>
<tr class="even">
<td>R objects (unique)</td>
<td>.rds</td>
<td><strong>base</strong></td>
<td><strong>base</strong></td>
<td>Présent</td>
</tr>
</tbody>
</table>
<p>Il est possible de sauvegarder l’ensemble ou une partie des données définies dans la session de R. Cette sauvegarde se réalise avec les instructions <code>save()</code> pour un ensemble d’objets et <code>save.image()</code>pour sauvegarder tous les objets.</p>
<p>La lecture se réalise par l’instruction <code>load()</code> et se réalise sous la forme d’un fichier binaire. Le format des fichiers est de type binaire et est pas conséquent un fichier propriétaire de R (compressé par R et lisible uniquement par R).</p>
<p>Nous allons expérimenter en créant trois objets en plus des objets existants</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()  <span class="co"># Objets présents</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] "dataset"      "Mes_packages" "p"            "Wages"        "Wages_p"     
&gt; [6] "Wages_s"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Université de Lille"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>) <span class="co"># Création de 3 objets</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()    <span class="co"># Liste des objets</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] "a"            "b"            "c"            "dataset"      "Mes_packages"
&gt; [6] "p"            "Wages"        "Wages_p"      "Wages_s"</code></pre>
</div>
</div>
<p>Ensuite nous sauvegardons uniquement les objets a,b et c par l’instruction <code>save()</code>. En ensuite nous sauvgardons l’ensemble des objets par l’instruction <code>save.image()</code>. Nous vérifions ensuite les tailles des fichiers respectifs par l’instruction <code>file.info()$size</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(a,b, <span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Lille.RData"</span>))           </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sauvegarde de deux objets sur un fichier .Rdata</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Lille_image.RData"</span>)) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sauvegarde totale sur un fichier .Rdata</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="fu">here</span>(<span class="st">"data/Lille.RData"</span>))<span class="sc">$</span>size           </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 100</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification du fichier</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="fu">here</span>(<span class="st">"data/Lille_image.RData"</span>))<span class="sc">$</span>size     </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 204415</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification du fichier</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>On vérifie l’opération en retirant les objets et en les rechargeant ensuite.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>))               <span class="co"># Suppression de a et b          </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()                                    <span class="co"># Liste de objets vide</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] "dataset"      "Mes_packages" "p"            "Wages"        "Wages_p"     
&gt; [6] "Wages_s"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Lille.RData"</span>)); <span class="fu">ls</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] "a"            "b"            "dataset"      "Mes_packages" "p"           
&gt; [6] "Wages"        "Wages_p"      "Wages_s"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Lille_image.RData"</span>));<span class="fu">ls</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] "a"            "b"            "c"            "dataset"      "Mes_packages"
&gt; [6] "p"            "Wages"        "Wages_p"      "Wages_s"</code></pre>
</div>
</div>
<p>L’avantage unique de ce type de fichier est la capacité de sauvegarder dans un seul fichier l’ensemble des objets peut importe le type.</p>
</section>
<section id="fichiers-.rds" class="level4">
<h4 class="anchored" data-anchor-id="fichiers-.rds">Fichiers .rds</h4>
<p>Le type de fichier .rds est plus limité et seul un objet sera sauvegardé (dataframe, matrice, liste,…). L’écriture se réalise avec <code>saveRDS()</code>, l’extension du fichier est .rds. La lecture se réalise avec l’instruction <code>readRDS</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Wages,<span class="at">package=</span><span class="st">"plm"</span>) </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Wages,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Wages_binaire.rds"</span>))   <span class="co"># Ecriture fichier binaire</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="fu">here</span>(<span class="st">"data/Wages_binaire.rds"</span>))<span class="sc">$</span>size       <span class="co"># Taille du fichier</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 34403</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Wages_RDS <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data/Wages_binaire.rds"</span>)) <span class="co"># Lecture du fichier</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(Wages_RDS,Wages)                         <span class="co"># Fichiers égaux ?</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] TRUE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Wages_RDS)                                      <span class="co"># Effacement données</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Nous disposeront également d’une possibilité plus simple de travailler si nous utilisont le package rio, il consiste qui a pour objet d’uniformiser la syntaxe pour les différents formats. Ainsi il suffira simplement d’utiliser la fonction rio::import(nom.extension) pour une importation et rio::export(nom.extension) pour une exportation. L’extension définira la méthode à utiliser. Le package choisit habituellement la fonction existante la plus performante pour réaliser la tâche.</p>
<p>Par exemple, voici une importation et exportation du fichier Wages comme précedemment avec rio:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Wages,<span class="at">package=</span><span class="st">"plm"</span>) </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(Wages,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Wages_rio.rds"</span>))   <span class="co"># Ecriture fichier compressé</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="fu">here</span>(<span class="st">"data/Wages_rio.rds"</span>))<span class="sc">$</span>size      <span class="co"># Taille du fichier</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 34403</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Wages_rio <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/Wages_rio.rds"</span>)) <span class="co"># Lecture du fichier</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(Wages_rio,Wages)                      <span class="co"># Fichiers égaux ?</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] TRUE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Wages_rio)                                   <span class="co"># Effacement données</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="fichiers-compressés-universels" class="level3">
<h3 class="anchored" data-anchor-id="fichiers-compressés-universels">Fichiers compressés universels</h3>
<p>Dans le cadre de fichiers portables, nous allons nous intéressé à deux formats de fichiers de type colonnes, qui ont l’avantage d’être supportés par de nombreuses plateformes:</p>
<ul>
<li>Le format Feather qui va contenir soit des tables Arrow ou des data frames de R ou Python. Son usage principal est de permettre un stockage de données commun à Python et R.</li>
<li>Le format Parquet qui est un format de type colonne principalement utilisé pour les problème utilisant les “big data”</li>
</ul>
<p>https://www.cetic.be/Apache-Parquet-pour-le-stockage-de-donnees-volumineuses</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/parquet-logique.png" class="img-fluid figure-img"></p>
<figcaption>Exemple de table classique</figcaption>
</figure>
</div>
<p>La structure typique d’un fichier csv sera orientée vers les lignes:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/parquet-row.png" class="img-fluid figure-img"></p>
<figcaption>Structure en lignes</figcaption>
</figure>
</div>
<p>a structure typique d’un fichier csv sera orientée vers les colonnes:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/parquet-col.png" class="img-fluid figure-img"></p>
<figcaption>Structure en colonnes</figcaption>
</figure>
</div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Format</th>
<th>Extension</th>
<th>Importation (Package)</th>
<th>Exportation (Package)</th>
<th>rio ?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Feather</td>
<td>.feather</td>
<td><a href="https://arrow.apache.org/docs/1.0/r/reference/read_parquet.html"><strong>arrow</strong></a></td>
<td><a href="https://cran.r-project.org/package=arrow"><strong>arrow</strong></a></td>
<td>oui</td>
</tr>
<tr class="even">
<td>Parquet</td>
<td>.parquet</td>
<td><a href="https://cran.r-project.org/package=arrow"><strong>arrow</strong></a></td>
<td><a href="https://cran.r-project.org/package=arrow"><strong>arrow</strong></a></td>
<td>oui</td>
</tr>
</tbody>
</table>
<p>Lecture/Ecriture à partir du format Feather</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>arrow<span class="sc">::</span><span class="fu">write_feather</span>(Wages,<span class="fu">here</span>(<span class="st">"data/Wages.feather"</span>)) <span class="co"># Ecriture des données (.feather)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>Wages_feather <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">read_feather</span>(<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Wages.feather"</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_select=</span><span class="fu">c</span>(<span class="st">"exp"</span>,<span class="st">"bluecol"</span>,<span class="st">"sex"</span>,<span class="st">"ed"</span>,<span class="st">"lwage"</span>))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture des données dans r</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Wages_feather)   <span class="co"># Affichage des données</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 6 × 5
&gt;     exp bluecol sex      ed lwage
&gt;   &lt;int&gt; &lt;fct&gt;   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
&gt; 1     3 no      male      9  5.56
&gt; 2     4 no      male      9  5.72
&gt; 3     5 no      male      9  6.00
&gt; 4     6 no      male      9  6.00
&gt; 5     7 no      male      9  6.06
&gt; 6     8 no      male      9  6.17</code></pre>
</div>
</div>
<p>Le même exercice sera réalisé à partir de rio</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>rio<span class="sc">::</span><span class="fu">export</span>(Wages,<span class="fu">here</span>(<span class="st">"data/Wages_rio.feather"</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Wages_rio <span class="ot">&lt;-</span>  rio<span class="sc">::</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/Wages_rio.feather"</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Wages_rio)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   exp wks bluecol ind south smsa married  sex union ed black   lwage
&gt; 1   3  32      no   0   yes   no     yes male    no  9    no 5.56068
&gt; 2   4  43      no   0   yes   no     yes male    no  9    no 5.72031
&gt; 3   5  40      no   0   yes   no     yes male    no  9    no 5.99645
&gt; 4   6  39      no   0   yes   no     yes male    no  9    no 5.99645
&gt; 5   7  42      no   1   yes   no     yes male    no  9    no 6.06146
&gt; 6   8  35      no   1   yes   no     yes male    no  9    no 6.17379</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages_rio,<span class="at">list.lenght=</span><span class="dv">3</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 4165 obs. of  12 variables:
&gt;  $ exp    : int  3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ wks    : int  32 43 40 39 42 35 32 34 27 33 ...
&gt;  $ bluecol: Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 2 2 2 ...
&gt;  $ ind    : int  0 0 0 0 1 1 1 0 0 1 ...
&gt;  $ south  : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 1 1 1 ...
&gt;  $ smsa   : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ married: Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
&gt;  $ sex    : Factor w/ 2 levels "male","female": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ union  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 2 ...
&gt;  $ ed     : int  9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ black  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ lwage  : num  5.56 5.72 6 6 6.06 ...</code></pre>
</div>
</div>
<p>Lecture/Ecriture à partir du format Parquet</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>arrow<span class="sc">::</span><span class="fu">write_parquet</span>(Wages,<span class="fu">here</span>(<span class="st">"data/Wages.parquet"</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture des données (.parquet)</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>Wages_parquet <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">read_parquet</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/Wages.parquet"</span>),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_select=</span><span class="fu">c</span>(<span class="st">"exp"</span>,<span class="st">"bluecol"</span>,<span class="st">"sex"</span>,<span class="st">"ed"</span>,<span class="st">"lwage"</span>))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture des données dans r</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Wages_parquet)  <span class="co"># Affichage des données</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 6 × 5
&gt;     exp bluecol sex      ed lwage
&gt;   &lt;int&gt; &lt;fct&gt;   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
&gt; 1     3 no      male      9  5.56
&gt; 2     4 no      male      9  5.72
&gt; 3     5 no      male      9  6.00
&gt; 4     6 no      male      9  6.00
&gt; 5     7 no      male      9  6.06
&gt; 6     8 no      male      9  6.17</code></pre>
</div>
</div>
<p>Le même exercice sera réalisé à partir de rio</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>rio<span class="sc">::</span><span class="fu">export</span>(Wages,<span class="fu">here</span>(<span class="st">"data/Wages_rio.parquet"</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Wages_rio <span class="ot">&lt;-</span>  rio<span class="sc">::</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/Wages_rio.parquet"</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">col_select=</span><span class="fu">c</span>(<span class="st">"exp"</span>,<span class="st">"bluecol"</span>,<span class="st">"sex"</span>,<span class="st">"ed"</span>,<span class="st">"lwage"</span>))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Wages_rio)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   exp bluecol  sex ed   lwage
&gt; 1   3      no male  9 5.56068
&gt; 2   4      no male  9 5.72031
&gt; 3   5      no male  9 5.99645
&gt; 4   6      no male  9 5.99645
&gt; 5   7      no male  9 6.06146
&gt; 6   8      no male  9 6.17379</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages_rio,<span class="at">list.lenght=</span><span class="dv">3</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 4165 obs. of  5 variables:
&gt;  $ exp    : int  3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ bluecol: Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 2 2 2 ...
&gt;  $ sex    : Factor w/ 2 levels "male","female": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ ed     : int  9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ lwage  : num  5.56 5.72 6 6 6.06 ...</code></pre>
</div>
</div>
</section>
<section id="fichiers-textes" class="level3">
<h3 class="anchored" data-anchor-id="fichiers-textes">Fichiers textes</h3>
<p>Les fichiers textes sont simplement des caractères lisible avec les colonnes séparées par un délimiteur. Quatre options sont possibles selon le format du fichier à lire:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Types</th>
<th style="text-align: center;">décimal</th>
<th style="text-align: right;">délimiteur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">delim</td>
<td style="text-align: center;">locale()</td>
<td style="text-align: right;">delim</td>
</tr>
<tr class="even">
<td style="text-align: left;">csv</td>
<td style="text-align: center;">.</td>
<td style="text-align: right;">,</td>
</tr>
<tr class="odd">
<td style="text-align: left;">csv2</td>
<td style="text-align: center;">,</td>
<td style="text-align: right;">;</td>
</tr>
<tr class="even">
<td style="text-align: left;">tsv</td>
<td style="text-align: center;">locale()</td>
<td style="text-align: right;">tab</td>
</tr>
</tbody>
</table>
<p>De nombreuses librairies permettent de lire des données en format texte.</p>
<p>Nous utilisons le fichier binaire ““bigfile.rds”. Il s’agit d’un fichier réels de 17872 lignes et 373 variable qui contient du texte et des nombres. Le contenu de ce fichier sera explicité dans la partie consacrée à SAS (nyts).</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture sous dataframe du fichier </span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>bf <span class="ot">&lt;-</span> <span class="fu">fake_ticket_client</span>(<span class="at">vol=</span><span class="dv">50000</span>,<span class="at">n =</span> <span class="dv">2000</span>,<span class="at">seed =</span> <span class="dv">2811</span>,<span class="at">local =</span> <span class="fu">c</span>( <span class="st">"fr_FR"</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bf)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; tibble [50,000 × 25] (S3: tbl_df/tbl/data.frame)
&gt;  $ ref                : chr [1:50000] "DOSS-KJSH-009518" "DOSS-ERWS-035357" "DOSS-EGBF-040728" "DOSS-QVDE-032652" ...
&gt;  $ num_client         : chr [1:50000] "1" "1" "1" "1" ...
&gt;  $ prenom             : chr [1:50000] "Gérard" "Gérard" "Gérard" "Gérard" ...
&gt;  $ nom                : chr [1:50000] "Fontainé" "Fontainé" "Fontainé" "Fontainé" ...
&gt;  $ job                : chr [1:50000] "Esthéticien" "Esthéticien" "Esthéticien" "Esthéticien" ...
&gt;  $ age                : num [1:50000] 62 62 62 62 62 62 63 63 63 NA ...
&gt;  $ region             : chr [1:50000] "Lorraine" "Lorraine" "Lorraine" "Lorraine" ...
&gt;  $ id_dpt             : chr [1:50000] "54" "54" "54" "54" ...
&gt;  $ departement        : chr [1:50000] "Meurthe-et-Moselle" "Meurthe-et-Moselle" "Meurthe-et-Moselle" "Meurthe-et-Moselle" ...
&gt;  $ gestionnaire_cb    : chr [1:50000] "VISA 13 digit" "VISA 13 digit" "VISA 13 digit" "VISA 13 digit" ...
&gt;  $ nom_complet        : chr [1:50000] "Gérard Fontainé" "Gérard Fontainé" "Gérard Fontainé" "Gérard Fontainé" ...
&gt;  $ entry_date         : POSIXct[1:50000], format: "2017-03-18 17:59:08" "2017-03-18 17:59:08" ...
&gt;  $ points_fidelite    : num [1:50000] 2773 2773 2773 2773 2773 ...
&gt;  $ priorite_encodee   : num [1:50000] 3 3 3 3 3 3 3 3 3 2 ...
&gt;  $ priorite           : Factor w/ 4 levels "Bronze","Silver",..: 3 3 3 3 3 3 3 3 3 2 ...
&gt;  $ timestamp          : Date[1:50000], format: "2017-04-05" "2017-05-23" ...
&gt;  $ annee              : num [1:50000] 2017 2017 2017 2017 2017 ...
&gt;  $ mois               : num [1:50000] 4 5 5 10 11 12 6 7 7 7 ...
&gt;  $ jour               : int [1:50000] 5 23 29 30 7 28 25 12 17 22 ...
&gt;  $ pris_en_charge     : chr [1:50000] "Non" "Non" "Oui" "Oui" ...
&gt;  $ pris_en_charge_code: int [1:50000] 0 0 1 1 1 1 1 1 1 1 ...
&gt;  $ type               : chr [1:50000] "Ligne" "Ligne" "Ligne" "Ligne" ...
&gt;  $ type_encoded       : int [1:50000] 3 3 3 3 3 2 2 1 1 3 ...
&gt;  $ etat               : Factor w/ 5 levels "En cours","Attente confirmation client",..: 5 5 2 4 3 2 2 5 3 2 ...
&gt;  $ source_appel       : Factor w/ 4 levels "Local","France",..: 2 1 4 4 4 2 4 3 4 4 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bf)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 25</code></pre>
</div>
</div>
<p>On sauvegarde ce fichier sous forme d’un fichier compressé qui nous sera utile poure le suite.</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture sous dataframe du fichierdu fichier </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(bf,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data/bf0.rds"</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="fu">here</span>(<span class="st">"data/bf0.rds"</span>))<span class="sc">$</span>size      </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 1880497</code></pre>
</div>
</div>
<p>On remarque la taille fichier qui est de <code>file.info(here("data/bigfile.rds"))$size</code>. Nous allons écrire ce fichier sous la forme d’un fichier texte. Nous avons le choix entre des fonctions de base et des fonctions proposées par les packages</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Package</th>
<th>Extension</th>
<th>Importation</th>
<th>Exportation</th>
<th>rio ?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Base</td>
<td>.csv</td>
<td>read.csv2</td>
<td>write.csv2</td>
<td>Non</td>
</tr>
<tr class="even">
<td>readr</td>
<td>.csv</td>
<td>read_csv2</td>
<td>write_csv2</td>
<td>Non</td>
</tr>
<tr class="odd">
<td>data.table</td>
<td>.csv</td>
<td>fread</td>
<td>fwrite</td>
<td>Oui</td>
</tr>
<tr class="even">
<td>vroom</td>
<td>.csv</td>
<td>read.csv2</td>
<td>write.csv2</td>
<td>Non</td>
</tr>
</tbody>
</table>
<p>Ecriture avec les fonctions de base de R soit <code>write.csv2</code> et <code>read.csv2</code>. Nous adoptons la version francophone de CSV soit CSV2 avec des colonnes séparées par des points virgules et le délimiteur décimal est la virgule</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">benchmark</span>(<span class="at">write.csv2=</span><span class="fu">write.csv2</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf1.csv"</span>)),</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">readr_write_csv=</span>readr<span class="sc">::</span><span class="fu">write_csv2</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf2.csv"</span>)),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data.table_fwrite=</span>data.table<span class="sc">::</span><span class="fu">fwrite</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf3.csv"</span>)),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">rio_export=</span>rio<span class="sc">::</span><span class="fu">export</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf4.csv"</span>)),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">vroom_vroom_write=</span>vroom<span class="sc">::</span><span class="fu">vroom_write</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf5.csv"</span>)),   </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">replications=</span><span class="dv">1</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">columns=</span><span class="fu">c</span>(<span class="st">'test'</span>,<span class="st">'user.self'</span>,<span class="st">'sys.self'</span>, <span class="st">'elapsed'</span>, <span class="st">'replications'</span>),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">order=</span><span class="cn">NULL</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;                test user.self sys.self elapsed replications
&gt; 1        write.csv2     0.313    0.009   0.323            1
&gt; 2   readr_write_csv     0.164    0.033   0.129            1
&gt; 3 data.table_fwrite     0.028    0.002   0.029            1
&gt; 4        rio_export     0.030    0.002   0.031            1
&gt; 5 vroom_vroom_write     0.173    0.111   0.085            1</code></pre>
</div>
</div>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fichiers_liste <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data/bf"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">".csv"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>bench_size <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fichiers=</span>fichiers_liste)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>bench_size<span class="sc">$</span>Fonction <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"base csv"</span>,<span class="st">"readr"</span>,<span class="st">"data.table"</span>,<span class="st">"rio"</span>,<span class="st">"vroom"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>bench_size<span class="sc">$</span>Taille <span class="ot">&lt;-</span> <span class="fu">file.size</span>(bench_size<span class="sc">$</span>Fichiers)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>bench_size</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;       Fichiers   Fonction Taille
&gt; 1 data/bf1.csv   base csv     NA
&gt; 2 data/bf2.csv      readr     NA
&gt; 3 data/bf3.csv data.table     NA
&gt; 4 data/bf4.csv        rio     NA
&gt; 5 data/bf5.csv      vroom     NA</code></pre>
</div>
</div>
<p>La taille des fichiers est relativement similaire avec les différents formats de fichiers texte. Cependant le temps d’écriture et de lecture est fort variable. Nous utilisons la fonction <code>system.time()</code> pour mesurer le temps écoulé.</p>
<p>Pour la lecture:</p>
<p>les performance sont variables avec la fonction vroom() qui est toujours la plus rapide data.table est le plus rapide</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">benchmark</span>(<span class="at">read.csv2=</span><span class="fu">read.csv2</span>(<span class="fu">here</span>(<span class="st">"data/bf1.csv"</span>)),</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">readr_read_csv=</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data/bf2.csv"</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>),</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data.table_fread=</span>data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">here</span>(<span class="st">"data/bf3.csv"</span>)),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">rio_import=</span>rio<span class="sc">::</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/bf4.csv"</span>)),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">vroom_vroom=</span>vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"data/bf5.csv"</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>),        </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">replications=</span><span class="dv">1</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">columns=</span><span class="fu">c</span>(<span class="st">'test'</span>,<span class="st">'user.self'</span>,<span class="st">'sys.self'</span>, <span class="st">'elapsed'</span>, <span class="st">'replications'</span>),</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">order=</span><span class="cn">NULL</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;               test user.self sys.self elapsed replications
&gt; 1        read.csv2     0.177    0.005   0.183            1
&gt; 2   readr_read_csv     0.086    0.002   0.032            1
&gt; 3 data.table_fread     0.044    0.001   0.045            1
&gt; 4       rio_import     0.044    0.001   0.046            1
&gt; 5      vroom_vroom     0.073    0.002   0.011            1</code></pre>
</div>
</div>
</section>
<section id="comparaison-fichiers-textes-et-compressés" class="level3">
<h3 class="anchored" data-anchor-id="comparaison-fichiers-textes-et-compressés">Comparaison fichiers textes et compressés</h3>
<p>Nous allon comparer le format csv le plus performant (vromm) avec les formats compressés (rds, feather et parquet)</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">benchmark</span>(<span class="at">csv=</span>vroom<span class="sc">::</span><span class="fu">vroom_write</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf.csv"</span>)) ,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">rds=</span><span class="fu">export</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf.rds"</span>)) ,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">feather=</span><span class="fu">export</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf.feather"</span>)) ,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">parquet=</span><span class="fu">export</span>(bf,<span class="fu">here</span>(<span class="st">"data/bf.parquet"</span>)), </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">replications=</span><span class="dv">1</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">columns=</span><span class="fu">c</span>(<span class="st">'test'</span>,<span class="st">'user.self'</span>,<span class="st">'sys.self'</span>, <span class="st">'elapsed'</span>, <span class="st">'replications'</span>),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">order=</span><span class="cn">NULL</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;      test user.self sys.self elapsed replications
&gt; 1     csv     0.171    0.113   0.087            1
&gt; 2     rds     0.318    0.001   0.319            1
&gt; 3 feather     0.034    0.003   0.019            1
&gt; 4 parquet     0.045    0.002   0.043            1</code></pre>
</div>
</div>
<p>On constate en écriture que le fichier <strong>rds</strong> est le plus lent suivi du <strong>csv</strong> , les autres formats sont proches, le plus rapide est clairement <strong>feather</strong></p>
<div class="cell" data-exercise="true" data-mesage="false">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>bench_size <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fichiers=</span><span class="fu">c</span>(<span class="st">"data/bf.csv"</span>,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"data/bf.feather"</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"data/bf.rds"</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"data/bf.parquet"</span>))</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>bench_size<span class="sc">$</span>Fonction <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"vroom"</span>,<span class="st">"arrow feather"</span>,<span class="st">"rds"</span>,<span class="st">"arrow parquet"</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>bench_size<span class="sc">$</span>Taille <span class="ot">&lt;-</span> <span class="fu">file.size</span>(bench_size<span class="sc">$</span>Fichiers)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>bench_size</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;          Fichiers      Fonction Taille
&gt; 1     data/bf.csv         vroom     NA
&gt; 2 data/bf.feather arrow feather     NA
&gt; 3     data/bf.rds           rds     NA
&gt; 4 data/bf.parquet arrow parquet     NA</code></pre>
</div>
</div>
<p>On constate pour les tailles que le fichier <strong>csv</strong> est le plus imposant suivi du format <strong>feather</strong>, les autres format sont nettement plus compressés, le plus léger est <strong>parquet</strong></p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">benchmark</span>(<span class="at">vroom_csv=</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/bf.csv"</span>)) ,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">rds=</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/bf.rds"</span>)) ,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">feather=</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/bf.feather"</span>)) ,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">parquet=</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data/bf.parquet"</span>)), </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">replications=</span><span class="dv">1</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">columns=</span><span class="fu">c</span>(<span class="st">'test'</span>,<span class="st">'user.self'</span>,<span class="st">'sys.self'</span>, <span class="st">'elapsed'</span>, <span class="st">'replications'</span>),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">order=</span><span class="cn">NULL</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;        test user.self sys.self elapsed replications
&gt; 1 vroom_csv     0.043    0.001   0.045            1
&gt; 2       rds     0.109    0.001   0.110            1
&gt; 3   feather     0.006    0.003   0.004            1
&gt; 4   parquet     0.016    0.002   0.004            1</code></pre>
</div>
</div>
<p>On constate en lecture que le fichier <strong>rds</strong> est le plus lent suivi du <strong>csv</strong> , les autres formats sont les plus rapides.</p>
<p>La différence entre le binaire et le csv sera la taille et la vitesse de lecture</p>
<ul>
<li><p>Si on travaille sur de petits fichiers cela n’a pas d’importance.</p></li>
<li><p>Sur de gros fichiers, les avantages en terme de taille et de vitesse sont importants pour les fichiers compressés. Les fichiers universels sont plus efficaces en taille et en vitesse. Le format feather est à privilégier en vitesse et le format parquet est efficace en taille.</p></li>
</ul>
</section>
<section id="fichiers-de-tableurs-.xls.xlsx" class="level3">
<h3 class="anchored" data-anchor-id="fichiers-de-tableurs-.xls.xlsx">Fichiers de tableurs (.xls,.xlsx)</h3>
<p>Le format tableur est souvent utile pour transmettre ou recevoir des données. Deux formats sont possibles soit le format ancien (.xls) ou le format actual (.xlsx). Pour lire un format ancien, <code>readxl</code> est le plus adapté.. Si nous travaillons avec des formats plus modernes, le package <code>openxlsx</code> est mieux adapté et beaucoup plus flexible pour le formatage des données. Le package <code>rio</code> simplifie l’usage de ce package au prix d’une flexibilité plus faible</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Format</th>
<th style="text-align: left;">Extension</th>
<th style="text-align: left;">Importation (Package)</th>
<th style="text-align: left;">Exportation (Package)</th>
<th style="text-align: left;">rio ?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Excel</td>
<td style="text-align: left;">.xls</td>
<td style="text-align: left;"><a href="https://cran.r-project.org/package=readxl"><strong>readxl</strong></a></td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">non</td>
</tr>
<tr class="even">
<td style="text-align: left;">Excel</td>
<td style="text-align: left;">.xlsx</td>
<td style="text-align: left;"><a href="https://cran.r-project.org/package=readxl"><strong>openxlsx</strong></a></td>
<td style="text-align: left;"><a href="https://cran.r-project.org/package=openxlsx"><strong>openxlsx</strong></a></td>
<td style="text-align: left;">Oui</td>
</tr>
</tbody>
</table>
<p>Nous reprenons les données sur les salaires pour illustrer les opérations: L’objectif sera de séparer la base de données en deux groupes (hommes et femmes) et d’écrire les bases dans deux feuilles séparées d’un classeur</p>
<p>On commence par séparer les deux groupes :</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Wages)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>&gt; Warning in data(Wages): data set 'Wages' not found</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>Wages_m <span class="ot">&lt;-</span> Wages[Wages<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"male"</span>,]            <span class="co"># Sélection des hommes</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>Wages_f <span class="ot">&lt;-</span> Wages[Wages<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"female"</span>,]          <span class="co"># Sélection des femmes</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>L’écriture <code>Wages[sex=="male",]</code> n’est pas valable car le nom <code>sex</code> n’est pas défini auparavant</p>
</div>
</div>
<p>Par exemple nous écrivons dans le nouveau format avec</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exriture des données</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">createWorkbook</span>(<span class="at">title=</span><span class="st">"Wages_split"</span>)             <span class="co"># Création du tableur vide </span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">addWorksheet</span>(wb,<span class="st">"Wage_M_s"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">addWorksheet</span>(wb,<span class="st">"Wage_F_s"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">writeData</span>(wb, <span class="st">"Wage_M_s"</span>, Wages_m,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowNames =</span> <span class="cn">TRUE</span>, <span class="at">startCol =</span> <span class="st">"C"</span>, <span class="at">startRow =</span> <span class="dv">3</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">borders =</span> <span class="st">"surrounding"</span>, <span class="at">borderColour =</span> <span class="st">"black"</span>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">writeData</span>(wb, <span class="st">"Wage_F_s"</span>, Wages_f,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowNames =</span> <span class="cn">TRUE</span>, <span class="at">startCol =</span> <span class="st">"C"</span>, <span class="at">startRow =</span> <span class="dv">3</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">borders =</span> <span class="st">"surrounding"</span>, <span class="at">borderColour =</span> <span class="st">"red"</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">saveWorkbook</span>(wb, <span class="at">file =</span> <span class="st">"data/Wages.xlsx"</span>, </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture des données</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>Wage_M_s <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">readWorkbook</span>(<span class="at">xlsxFile =</span> <span class="fu">here</span>(<span class="st">"data/Wages.xlsx"</span>),<span class="at">sheet=</span><span class="st">"Wage_M_s"</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>Wage_F_s <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">readWorkbook</span>(<span class="at">xlsxFile =</span> <span class="fu">here</span>(<span class="st">"data/Wages.xlsx"</span>),<span class="at">sheet=</span><span class="st">"Wage_F_s"</span>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wage_M_s)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 3696 obs. of  12 variables:
&gt;  $ exp    : num  3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ wks    : num  32 43 40 39 42 35 32 34 27 33 ...
&gt;  $ bluecol: chr  "no" "no" "no" "no" ...
&gt;  $ ind    : num  0 0 0 0 1 1 1 0 0 1 ...
&gt;  $ south  : chr  "yes" "yes" "yes" "yes" ...
&gt;  $ smsa   : chr  "no" "no" "no" "no" ...
&gt;  $ married: chr  "yes" "yes" "yes" "yes" ...
&gt;  $ sex    : chr  "male" "male" "male" "male" ...
&gt;  $ union  : chr  "no" "no" "no" "no" ...
&gt;  $ ed     : num  9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ black  : chr  "no" "no" "no" "no" ...
&gt;  $ lwage  : num  5.56 5.72 6 6 6.06 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wage_F_s)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 469 obs. of  12 variables:
&gt;  $ exp    : num  31 32 33 34 35 36 37 9 10 11 ...
&gt;  $ wks    : num  52 46 46 49 44 52 46 50 46 48 ...
&gt;  $ bluecol: chr  "yes" "yes" "yes" "yes" ...
&gt;  $ ind    : num  0 0 0 0 0 0 0 0 0 0 ...
&gt;  $ south  : chr  "no" "no" "no" "no" ...
&gt;  $ smsa   : chr  "yes" "yes" "yes" "yes" ...
&gt;  $ married: chr  "no" "no" "no" "no" ...
&gt;  $ sex    : chr  "female" "female" "female" "female" ...
&gt;  $ union  : chr  "no" "no" "no" "no" ...
&gt;  $ ed     : num  10 10 10 10 10 10 10 14 14 14 ...
&gt;  $ black  : chr  "yes" "yes" "yes" "yes" ...
&gt;  $ lwage  : num  6.16 6.24 6.3 6.36 6.47 ...</code></pre>
</div>
</div>
<p>La même opération avec <code>rio</code>, beaucoup plus compact mais moins flexible</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>rio<span class="sc">::</span><span class="fu">export</span>(<span class="fu">list</span>(<span class="at">Wage_M_s =</span> Wages_m, <span class="at">Wage_F_s =</span> Wages_f), <span class="at">file=</span><span class="st">"data/Wages.xlsx"</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>Wages_i <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import_list</span>(<span class="at">which=</span><span class="fu">c</span>(<span class="st">"Wage_M_s"</span>,<span class="st">"Wage_F_s"</span>),<span class="at">file=</span><span class="st">"data/Wages.xlsx"</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages_i<span class="sc">$</span>Wage_M_s)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 3696 obs. of  12 variables:
&gt;  $ exp    : num  3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ wks    : num  32 43 40 39 42 35 32 34 27 33 ...
&gt;  $ bluecol: chr  "no" "no" "no" "no" ...
&gt;  $ ind    : num  0 0 0 0 1 1 1 0 0 1 ...
&gt;  $ south  : chr  "yes" "yes" "yes" "yes" ...
&gt;  $ smsa   : chr  "no" "no" "no" "no" ...
&gt;  $ married: chr  "yes" "yes" "yes" "yes" ...
&gt;  $ sex    : chr  "male" "male" "male" "male" ...
&gt;  $ union  : chr  "no" "no" "no" "no" ...
&gt;  $ ed     : num  9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ black  : chr  "no" "no" "no" "no" ...
&gt;  $ lwage  : num  5.56 5.72 6 6 6.06 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages_i<span class="sc">$</span>Wage_F_s)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 469 obs. of  12 variables:
&gt;  $ exp    : num  31 32 33 34 35 36 37 9 10 11 ...
&gt;  $ wks    : num  52 46 46 49 44 52 46 50 46 48 ...
&gt;  $ bluecol: chr  "yes" "yes" "yes" "yes" ...
&gt;  $ ind    : num  0 0 0 0 0 0 0 0 0 0 ...
&gt;  $ south  : chr  "no" "no" "no" "no" ...
&gt;  $ smsa   : chr  "yes" "yes" "yes" "yes" ...
&gt;  $ married: chr  "no" "no" "no" "no" ...
&gt;  $ sex    : chr  "female" "female" "female" "female" ...
&gt;  $ union  : chr  "no" "no" "no" "no" ...
&gt;  $ ed     : num  10 10 10 10 10 10 10 14 14 14 ...
&gt;  $ black  : chr  "yes" "yes" "yes" "yes" ...
&gt;  $ lwage  : num  6.16 6.24 6.3 6.36 6.47 ...</code></pre>
</div>
</div>
<p>Utilisation du format ancien</p>
<p>Opération inverse de récupération des données:</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lecture </span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>Wages_m <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="fu">here</span>(<span class="st">"data/Wages.xls"</span>),<span class="at">sheet=</span><span class="st">"Wage_M_s"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Wages_f <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="fu">here</span>(<span class="st">"data/Wages.xls"</span>),<span class="at">sheet=</span><span class="st">"Wage_F_s"</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>Wages_xls <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Wages_m,Wages_f)                 <span class="co"># recréation des données</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages)                                  <span class="co"># Vérification</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; 'data.frame': 4165 obs. of  12 variables:
&gt;  $ exp    : int  3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ wks    : int  32 43 40 39 42 35 32 34 27 33 ...
&gt;  $ bluecol: Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 2 2 2 ...
&gt;  $ ind    : int  0 0 0 0 1 1 1 0 0 1 ...
&gt;  $ south  : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 1 1 1 ...
&gt;  $ smsa   : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ married: Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
&gt;  $ sex    : Factor w/ 2 levels "male","female": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ union  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 2 ...
&gt;  $ ed     : int  9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ black  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
&gt;  $ lwage  : num  5.56 5.72 6 6 6.06 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Wages_xls)                                  <span class="co"># Vérification</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; tibble [4,165 × 12] (S3: tbl_df/tbl/data.frame)
&gt;  $ exp    : num [1:4165] 3 4 5 6 7 8 9 30 31 32 ...
&gt;  $ wks    : num [1:4165] 32 43 40 39 42 35 32 34 27 33 ...
&gt;  $ bluecol: chr [1:4165] "no" "no" "no" "no" ...
&gt;  $ ind    : num [1:4165] 0 0 0 0 1 1 1 0 0 1 ...
&gt;  $ south  : chr [1:4165] "yes" "yes" "yes" "yes" ...
&gt;  $ smsa   : chr [1:4165] "no" "no" "no" "no" ...
&gt;  $ married: chr [1:4165] "yes" "yes" "yes" "yes" ...
&gt;  $ sex    : chr [1:4165] "male" "male" "male" "male" ...
&gt;  $ union  : chr [1:4165] "no" "no" "no" "no" ...
&gt;  $ ed     : num [1:4165] 9 9 9 9 9 9 9 11 11 11 ...
&gt;  $ black  : chr [1:4165] "no" "no" "no" "no" ...
&gt;  $ lwage  : num [1:4165] 5.56 5.72 6 6 6.06 ...</code></pre>
</div>
</div>
</section>
<section id="compatibilité-sasspss-et-stata" class="level3">
<h3 class="anchored" data-anchor-id="compatibilité-sasspss-et-stata">Compatibilité SAS,SPSS et Stata</h3>
<p>Pour ces formats particuliers , nous avons deux options soit utiliser le package <strong><em>heaven</em></strong> soit le package <strong><em>rio</em></strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Format</th>
<th>Extension</th>
<th>Importation</th>
<th>Exportation</th>
<th>rio ?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SAS</td>
<td>.sas7bdat</td>
<td><a href="https://haven.tidyverse.org/reference/read_sas.html"><strong>read_sas</strong></a></td>
<td><a href="https://haven.tidyverse.org/reference/write_sas.html"><strong>write_sas</strong></a></td>
<td>Oui</td>
</tr>
<tr class="even">
<td>SAS XPORT</td>
<td>.xpt</td>
<td><a href="https://haven.tidyverse.org/reference/read_xpt.html"><strong>read_xpt</strong></a></td>
<td><a href="https://haven.tidyverse.org/reference/read_xpt.html"><strong>write_xpt</strong></a></td>
<td>Oui</td>
</tr>
<tr class="odd">
<td>SPSS</td>
<td>.sav</td>
<td><a href="https://haven.tidyverse.org/reference/read_spss.html"><strong>read_sav</strong></a></td>
<td><a href="https://haven.tidyverse.org/reference/read_spss.html"><strong>write_sav</strong></a></td>
<td>Oui</td>
</tr>
<tr class="even">
<td>SPSS (compressed)</td>
<td>.zsav</td>
<td><a href="https://haven.tidyverse.org/reference/read_sav.html"><strong>read_sav</strong></a></td>
<td><a href="https://haven.tidyverse.org/reference/read_sav.html"><strong>write_sav</strong></a></td>
<td>Oui</td>
</tr>
<tr class="odd">
<td>SPSS Portable</td>
<td>.por</td>
<td><a href="https://haven.tidyverse.org/reference/read_spss.html"><strong>read_por</strong></a></td>
<td></td>
<td>Oui</td>
</tr>
<tr class="even">
<td>Stata</td>
<td>.dta</td>
<td><a href="https://haven.tidyverse.org/reference/read_dta.html"><strong>read_dta</strong></a></td>
<td><a href="https://haven.tidyverse.org/reference/read_dta.html"><strong>write_dta</strong></a></td>
<td>Oui</td>
</tr>
</tbody>
</table>
<p>On dispose sur le www de nombreux fichiers au format sas qui comportent souvent des informations fort détaillées sur les données. Les fichiers sur les enquêtes ou sondages sont souvent de cette nature. Nous prenons comme exemple l’enquête nyts (National Youth Tabacco Survey) du CDC (Center for Diseases control and prevention) voir: https://www.cdc.gov/tobacco/data_statistics/surveys/nyts/index.html. Base de donnée de sondage typique avec 17872 personnes interrogées répondant à 373 questions.</p>
<p>Les fichiers se composent de deux parties, une partie pour les données (extension .sas7bdat) et une partie pour le format (extension .sas7bcat). Le package `haven’ nous permet de lire facilement ces données et de récupérer l’information (certaines opérations complémentaires seront parfois nécessaires).</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>nyts <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="at">data_file    =</span> <span class="fu">here</span>(<span class="st">"data/nyts2017.sas7bdat"</span>),</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">catalog_file =</span> <span class="fu">here</span>(<span class="st">"data/formats.sas7bcat"</span>))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>nyts[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 3
&gt;    Q1                Q2         Q3       
&gt;    &lt;chr+lbl&gt;         &lt;chr+lbl&gt;  &lt;chr+lbl&gt;
&gt;  1 05 [13 years old] 2 [Female] 2 [7th]  
&gt;  2 04 [12 years old] 2 [Female] 2 [7th]  
&gt;  3 04 [12 years old] 2 [Female] 2 [7th]  
&gt;  4 04 [12 years old] 2 [Female] 2 [7th]  
&gt;  5 05 [13 years old] 2 [Female] 2 [7th]  
&gt;  6 04 [12 years old] 2 [Female] 1 [6th]  
&gt;  7 03 [11 years old] 2 [Female] 1 [6th]  
&gt;  8 03 [11 years old] 2 [Female] 1 [6th]  
&gt;  9 03 [11 years old] 2 [Female] 1 [6th]  
&gt; 10 04 [12 years old] 2 [Female] 1 [6th]</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>rio<span class="sc">::</span><span class="fu">export</span>(nyts,<span class="fu">here</span>(<span class="st">"data/nyts.rds"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Il est possible d’utiliser <code>rio</code> pour lire les données (pas le catalogue)</p>
<div class="cell" data-exercise="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>nyts <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="at">file    =</span> <span class="fu">here</span>(<span class="st">"data/nyts2017.sas7bdat"</span>))</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>nyts[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;    Q1 Q2 Q3
&gt; 1  05  2  2
&gt; 2  04  2  2
&gt; 3  04  2  2
&gt; 4  04  2  2
&gt; 5  05  2  2
&gt; 6  04  2  1
&gt; 7  03  2  1
&gt; 8  03  2  1
&gt; 9  03  2  1
&gt; 10 04  2  1</code></pre>
</div>
</div>
<!-- ### Exercice -->
<!-- En utilisant le set de données ”Males” du package plm: -->
<!-- - Créez un fichier binaire contenant tous les travailleurs mariés de 85 et 86. -->
<!-- - Créez une feuille Excel avec tous les travailleurs affiliés à un syndicat (union). -->
<!-- Lisez les fichiers ”fichier1.txt" à fichier4.txt” dans R. -->
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb94" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Analyse des données</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> 1. Importation/Exportation (IO)</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Philippe Vanden Eeckaut</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> Entrées et sorties dans R</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co">   typst: </span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co">      number-sections: true</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co">      papersize: A4</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="co">   html:</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">      code-fold: true</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co">      code-tools: true</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--# Spécification des options --&gt;</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE)</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Importation/Exportation (IO)</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Principes</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>La lecture de données se réalise de diverses manières:</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Données internes de R (importation)</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Depuis les packages.</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Données externes de R (importation/exportation)</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Données compressées</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Format propriétaire de R (.rda/.rds)</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Format ouvert (.feather/.parquet)</span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Données au format texte</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Fichiers textes formatés (.csv)</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Données au format d'autres applications</span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Fichiers de tableurs (.xls,.xlsx)</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>fichiers statistiques (sas,spss,....=)</span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>On va à partir de cette session utiliser des ***packages***. Pour utiliser</span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>un package deux opérations sont nécessaires:</span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Installer le package*:</span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>La première opération consiste à récupérer le package sur un</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>        serveur. Un serveur est toujours utilisé par défaut dans</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>        Rstudio.</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pour vérifier le serveur utilisé il faut aller voir la section</span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>        package dans les préférence de Rstudio.</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>L'installation d'un package se fait soit par l'intetface de</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>        Rstudio soit dans la fenêtre 'sud est ' de Rstudio et l'onglet</span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>        package avec Install soit par l'instruction</span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>        <span class="in">`install.packages()`</span>. Il sera alors présent sur la machine (il</span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>        est disponible dans la liste de la fenêtre package de Rstudio)</span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Charger le package*:</span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pour utiliser le package durant une session de Rstudio il est</span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>        nécessaire de charger le package par la commande <span class="in">`library()`</span>.</span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Dans la fenêtre <span class="in">`sud-est`</span> à l'onglet <span class="in">`Packages`</span> on dispose de la</span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a>        liste des packages disponible sur la machine et ceux chargés</span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a>        seront cochés. (Certains packages sont toujoutrs disponibles:</span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a>        base,datasets,datasets,grDevices,methods,utils )</span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a>Pour simplifier l'ensemble du processus, il est plus facile réaliser les</span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a>deux opérations en une fois avec les instructions ci-dessous</span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages,comment="&gt;",message=FALSE,warning=FALSE}</span></span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a><span class="in">Mes_packages = c('rio',</span></span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a><span class="in">                 'openxlsx','readxl',</span></span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a><span class="in">                 'feather','arrow',</span></span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a><span class="in">                 'data.table',</span></span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a><span class="in">                 'here',</span></span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a><span class="in">                 'rbenchmark','fakir')        </span></span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a><span class="in"># Liste des packages nécessaires</span></span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a><span class="in">for(p in Mes_packages){                                  </span></span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a><span class="in">  if(!require(p,character.only = TRUE)) </span></span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a><span class="in">    install.packages(p,repos = "http://cran.us.r-project.org")       </span></span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a><span class="in">  # si le package est absent on l'installe</span></span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a><span class="in">  library(p,character.only = TRUE)                              </span></span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a><span class="in">  # On charge ensuite tous les packages</span></span>
<span id="cb94-84"><a href="#cb94-84" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb94-85"><a href="#cb94-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-86"><a href="#cb94-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-87"><a href="#cb94-87" aria-hidden="true" tabindex="-1"></a><span class="fu">## Données internes</span></span>
<span id="cb94-88"><a href="#cb94-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-89"><a href="#cb94-89" aria-hidden="true" tabindex="-1"></a>La manière la plus simple est de lire les données incluses directement</span>
<span id="cb94-90"><a href="#cb94-90" aria-hidden="true" tabindex="-1"></a>dans un package. Au départ une ensemble de packages est déjà chargé dans</span>
<span id="cb94-91"><a href="#cb94-91" aria-hidden="true" tabindex="-1"></a>Rstudio. Ainsi par exemple, nous avons le package <span class="in">`datasets`</span>qui comporte</span>
<span id="cb94-92"><a href="#cb94-92" aria-hidden="true" tabindex="-1"></a>de nombreuses données qui sont visible avec la fonction <span class="sc">\`</span>data()'</span>
<span id="cb94-93"><a href="#cb94-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-94"><a href="#cb94-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-95"><a href="#cb94-95" aria-hidden="true" tabindex="-1"></a><span class="in">dataset &lt;- data(package="datasets")  # Lecture de la liste</span></span>
<span id="cb94-96"><a href="#cb94-96" aria-hidden="true" tabindex="-1"></a><span class="in">head(dataset$results[,3:4])          # Affichage des 6 premiers</span></span>
<span id="cb94-97"><a href="#cb94-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-98"><a href="#cb94-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-99"><a href="#cb94-99" aria-hidden="true" tabindex="-1"></a>Si nous avons besoin de données présentes dans un package précis, il est</span>
<span id="cb94-100"><a href="#cb94-100" aria-hidden="true" tabindex="-1"></a>nécessaire de le charger au préalable.</span>
<span id="cb94-101"><a href="#cb94-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-102"><a href="#cb94-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plm_install,exercise=TRUE,comment="&gt;"}</span></span>
<span id="cb94-103"><a href="#cb94-103" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("plm",repos = "http://cran.us.r-project.org")</span></span>
<span id="cb94-104"><a href="#cb94-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-105"><a href="#cb94-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-106"><a href="#cb94-106" aria-hidden="true" tabindex="-1"></a>Par la même commande <span class="in">`data(package=&lt;package&gt;)`</span> il est possible de</span>
<span id="cb94-107"><a href="#cb94-107" aria-hidden="true" tabindex="-1"></a>visualiser les données de ce package. Les données sont visibles</span>
<span id="cb94-108"><a href="#cb94-108" aria-hidden="true" tabindex="-1"></a>uniquement dans une fenêtre de Rstudio.</span>
<span id="cb94-109"><a href="#cb94-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-110"><a href="#cb94-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plm_data,exercise=TRUE,comment="&gt;"}</span></span>
<span id="cb94-111"><a href="#cb94-111" aria-hidden="true" tabindex="-1"></a><span class="in">data(package="plm")  # Liste des données disponibles</span></span>
<span id="cb94-112"><a href="#cb94-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-113"><a href="#cb94-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-114"><a href="#cb94-114" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb94-115"><a href="#cb94-115" aria-hidden="true" tabindex="-1"></a><span class="in">Data sets in package ‘plm’:</span></span>
<span id="cb94-116"><a href="#cb94-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-117"><a href="#cb94-117" aria-hidden="true" tabindex="-1"></a><span class="in">Cigar                 Cigarette Consumption</span></span>
<span id="cb94-118"><a href="#cb94-118" aria-hidden="true" tabindex="-1"></a><span class="in">Crime                 Crime in North Carolina</span></span>
<span id="cb94-119"><a href="#cb94-119" aria-hidden="true" tabindex="-1"></a><span class="in">EmplUK                Employment and Wages in the United Kingdom</span></span>
<span id="cb94-120"><a href="#cb94-120" aria-hidden="true" tabindex="-1"></a><span class="in">Gasoline              Gasoline Consumption</span></span>
<span id="cb94-121"><a href="#cb94-121" aria-hidden="true" tabindex="-1"></a><span class="in">Grunfeld              Grunfeld's Investment Data</span></span>
<span id="cb94-122"><a href="#cb94-122" aria-hidden="true" tabindex="-1"></a><span class="in">Hedonic               Hedonic Prices of Census Tracts in the</span></span>
<span id="cb94-123"><a href="#cb94-123" aria-hidden="true" tabindex="-1"></a><span class="in">                      Boston Area</span></span>
<span id="cb94-124"><a href="#cb94-124" aria-hidden="true" tabindex="-1"></a><span class="in">LaborSupply           Wages and Hours Worked</span></span>
<span id="cb94-125"><a href="#cb94-125" aria-hidden="true" tabindex="-1"></a><span class="in">Males                 Wages and Education of Young Males</span></span>
<span id="cb94-126"><a href="#cb94-126" aria-hidden="true" tabindex="-1"></a><span class="in">Parity                Purchasing Power Parity and other parity</span></span>
<span id="cb94-127"><a href="#cb94-127" aria-hidden="true" tabindex="-1"></a><span class="in">                      relationships</span></span>
<span id="cb94-128"><a href="#cb94-128" aria-hidden="true" tabindex="-1"></a><span class="in">Produc                US States Production</span></span>
<span id="cb94-129"><a href="#cb94-129" aria-hidden="true" tabindex="-1"></a><span class="in">RiceFarms             Production of Rice in Indonesia</span></span>
<span id="cb94-130"><a href="#cb94-130" aria-hidden="true" tabindex="-1"></a><span class="in">Snmesp                Employment and Wages in Spain</span></span>
<span id="cb94-131"><a href="#cb94-131" aria-hidden="true" tabindex="-1"></a><span class="in">SumHes                The Penn World Table, v. 5</span></span>
<span id="cb94-132"><a href="#cb94-132" aria-hidden="true" tabindex="-1"></a><span class="in">Wages                 Panel Data of Individual Wages</span></span>
<span id="cb94-133"><a href="#cb94-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-134"><a href="#cb94-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-135"><a href="#cb94-135" aria-hidden="true" tabindex="-1"></a>Pour nos besoins nous utiliserons l'ensemble de données "Wages". Ces</span>
<span id="cb94-136"><a href="#cb94-136" aria-hidden="true" tabindex="-1"></a>données regroupent des informations sur une cohorte de 595 personnes qui</span>
<span id="cb94-137"><a href="#cb94-137" aria-hidden="true" tabindex="-1"></a>sont collectées aux Etats Unis annuellement entre 1976 et 1982 soit 4165</span>
<span id="cb94-138"><a href="#cb94-138" aria-hidden="true" tabindex="-1"></a>observations.</span>
<span id="cb94-139"><a href="#cb94-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-140"><a href="#cb94-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wages_install,exercise=TRUE,comment="&gt;"}</span></span>
<span id="cb94-141"><a href="#cb94-141" aria-hidden="true" tabindex="-1"></a><span class="in">data(Wages,package="plm") # Lecture du fichier "Wages"</span></span>
<span id="cb94-142"><a href="#cb94-142" aria-hidden="true" tabindex="-1"></a><span class="in">head(Wages,n=7)           # Affichage des 6 premières lignes</span></span>
<span id="cb94-143"><a href="#cb94-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-144"><a href="#cb94-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-145"><a href="#cb94-145" aria-hidden="true" tabindex="-1"></a>Une fois les données lues, il est utile de connaitre la description de</span>
<span id="cb94-146"><a href="#cb94-146" aria-hidden="true" tabindex="-1"></a>ces données. Une possibilité est d'aller dans l'aide de R et d'afficher</span>
<span id="cb94-147"><a href="#cb94-147" aria-hidden="true" tabindex="-1"></a>les informations disponibles:</span>
<span id="cb94-148"><a href="#cb94-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-149"><a href="#cb94-149" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb94-150"><a href="#cb94-150" aria-hidden="true" tabindex="-1"></a><span class="in">Wages {plm} R Documentation</span></span>
<span id="cb94-151"><a href="#cb94-151" aria-hidden="true" tabindex="-1"></a><span class="in">Panel Data of Individual Wages</span></span>
<span id="cb94-152"><a href="#cb94-152" aria-hidden="true" tabindex="-1"></a><span class="in">Description</span></span>
<span id="cb94-153"><a href="#cb94-153" aria-hidden="true" tabindex="-1"></a><span class="in">A panel of 595 individuals from 1976 to 1982, taken from the Panel Study of Income Dynamics (PSID).</span></span>
<span id="cb94-154"><a href="#cb94-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-155"><a href="#cb94-155" aria-hidden="true" tabindex="-1"></a><span class="in">The data are organized as a stacked time series/balanced panel, see Examples on how to convert to a pdata.frame.</span></span>
<span id="cb94-156"><a href="#cb94-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-157"><a href="#cb94-157" aria-hidden="true" tabindex="-1"></a><span class="in">Format</span></span>
<span id="cb94-158"><a href="#cb94-158" aria-hidden="true" tabindex="-1"></a><span class="in">A data frame containing:</span></span>
<span id="cb94-159"><a href="#cb94-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-160"><a href="#cb94-160" aria-hidden="true" tabindex="-1"></a><span class="in">exp       years of full-time work experience.</span></span>
<span id="cb94-161"><a href="#cb94-161" aria-hidden="true" tabindex="-1"></a><span class="in">wks       weeks worked.</span></span>
<span id="cb94-162"><a href="#cb94-162" aria-hidden="true" tabindex="-1"></a><span class="in">bluecol   blue collar?</span></span>
<span id="cb94-163"><a href="#cb94-163" aria-hidden="true" tabindex="-1"></a><span class="in">ind       works in a manufacturing industry?</span></span>
<span id="cb94-164"><a href="#cb94-164" aria-hidden="true" tabindex="-1"></a><span class="in">south     resides in the south?</span></span>
<span id="cb94-165"><a href="#cb94-165" aria-hidden="true" tabindex="-1"></a><span class="in">smsa      resides in a standard metropolitan statistical area?</span></span>
<span id="cb94-166"><a href="#cb94-166" aria-hidden="true" tabindex="-1"></a><span class="in">married   married?</span></span>
<span id="cb94-167"><a href="#cb94-167" aria-hidden="true" tabindex="-1"></a><span class="in">sex       a factor with levels "male" and "female"</span></span>
<span id="cb94-168"><a href="#cb94-168" aria-hidden="true" tabindex="-1"></a><span class="in">union     individual's wage set by a union contract?</span></span>
<span id="cb94-169"><a href="#cb94-169" aria-hidden="true" tabindex="-1"></a><span class="in">ed        years of education.</span></span>
<span id="cb94-170"><a href="#cb94-170" aria-hidden="true" tabindex="-1"></a><span class="in">black     is the individual black?</span></span>
<span id="cb94-171"><a href="#cb94-171" aria-hidden="true" tabindex="-1"></a><span class="in">lwage     logarithm of wage.</span></span>
<span id="cb94-172"><a href="#cb94-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-173"><a href="#cb94-173" aria-hidden="true" tabindex="-1"></a><span class="in">Details</span></span>
<span id="cb94-174"><a href="#cb94-174" aria-hidden="true" tabindex="-1"></a><span class="in">total number of observations : 4165</span></span>
<span id="cb94-175"><a href="#cb94-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-176"><a href="#cb94-176" aria-hidden="true" tabindex="-1"></a><span class="in">observation : individuals</span></span>
<span id="cb94-177"><a href="#cb94-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-178"><a href="#cb94-178" aria-hidden="true" tabindex="-1"></a><span class="in">country : United States</span></span>
<span id="cb94-179"><a href="#cb94-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-180"><a href="#cb94-180" aria-hidden="true" tabindex="-1"></a><span class="in">Source</span></span>
<span id="cb94-181"><a href="#cb94-181" aria-hidden="true" tabindex="-1"></a><span class="in">Online complements to Baltagi (2001):</span></span>
<span id="cb94-182"><a href="#cb94-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-183"><a href="#cb94-183" aria-hidden="true" tabindex="-1"></a><span class="in">https://www.wiley.com/legacy/wileychi/baltagi/</span></span>
<span id="cb94-184"><a href="#cb94-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-185"><a href="#cb94-185" aria-hidden="true" tabindex="-1"></a><span class="in">Online complements to Baltagi (2013):</span></span>
<span id="cb94-186"><a href="#cb94-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-187"><a href="#cb94-187" aria-hidden="true" tabindex="-1"></a><span class="in">https://bcs.wiley.com/he-bcs/Books?action=resource&amp;bcsId=4338&amp;itemId=1118672321&amp;resourceId=13452</span></span>
<span id="cb94-188"><a href="#cb94-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-189"><a href="#cb94-189" aria-hidden="true" tabindex="-1"></a><span class="in">References</span></span>
<span id="cb94-190"><a href="#cb94-190" aria-hidden="true" tabindex="-1"></a><span class="in">Baltagi BH (2001). Econometric Analysis of Panel Data, 3rd edition. John Wiley and Sons ltd.</span></span>
<span id="cb94-191"><a href="#cb94-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-192"><a href="#cb94-192" aria-hidden="true" tabindex="-1"></a><span class="in">Baltagi BH (2013). Econometric Analysis of Panel Data, 5th edition. John Wiley and Sons ltd.</span></span>
<span id="cb94-193"><a href="#cb94-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-194"><a href="#cb94-194" aria-hidden="true" tabindex="-1"></a><span class="in">Cornwell C, Rupert P (1988). “Efficient Estimation With Panel Data: an Empirical Comparison of Instrumental Variables Estimators.” Journal of Applied Econometrics, 3, 149–155.</span></span>
<span id="cb94-195"><a href="#cb94-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-196"><a href="#cb94-196" aria-hidden="true" tabindex="-1"></a><span class="in">Examples</span></span>
<span id="cb94-197"><a href="#cb94-197" aria-hidden="true" tabindex="-1"></a><span class="in">Run examples</span></span>
<span id="cb94-198"><a href="#cb94-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-199"><a href="#cb94-199" aria-hidden="true" tabindex="-1"></a><span class="in"># data set 'Wages' is organized as a stacked time series/balanced panel</span></span>
<span id="cb94-200"><a href="#cb94-200" aria-hidden="true" tabindex="-1"></a><span class="in">data("Wages", package = "plm")</span></span>
<span id="cb94-201"><a href="#cb94-201" aria-hidden="true" tabindex="-1"></a><span class="in">Wag &lt;- pdata.frame(Wages, index=595)</span></span>
<span id="cb94-202"><a href="#cb94-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-203"><a href="#cb94-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-204"><a href="#cb94-204" aria-hidden="true" tabindex="-1"></a>Il est ensuite possible de régarder la description de ces données par</span>
<span id="cb94-205"><a href="#cb94-205" aria-hidden="true" tabindex="-1"></a>l'instruction <span class="in">`str()`</span></span>
<span id="cb94-206"><a href="#cb94-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-207"><a href="#cb94-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wages1,exercise=TRUE,comment="&gt;"}</span></span>
<span id="cb94-208"><a href="#cb94-208" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages)            # Affichage de la description</span></span>
<span id="cb94-209"><a href="#cb94-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-210"><a href="#cb94-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-211"><a href="#cb94-211" aria-hidden="true" tabindex="-1"></a>Nous allons regarder plus spécifiquement les variables suivantes:</span>
<span id="cb94-212"><a href="#cb94-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-213"><a href="#cb94-213" aria-hidden="true" tabindex="-1"></a>| Variable | type   | Définition                         |</span>
<span id="cb94-214"><a href="#cb94-214" aria-hidden="true" tabindex="-1"></a>|----------|--------|------------------------------------|</span>
<span id="cb94-215"><a href="#cb94-215" aria-hidden="true" tabindex="-1"></a>| exp      | int    | années d'expériences (plein temps) |</span>
<span id="cb94-216"><a href="#cb94-216" aria-hidden="true" tabindex="-1"></a>| bluecol  | Factor | ouvrier ? (yes,no)                 |</span>
<span id="cb94-217"><a href="#cb94-217" aria-hidden="true" tabindex="-1"></a>| sex      | Factor | sexe ? (male,female)               |</span>
<span id="cb94-218"><a href="#cb94-218" aria-hidden="true" tabindex="-1"></a>| ed       | int    | années d'étude                     |</span>
<span id="cb94-219"><a href="#cb94-219" aria-hidden="true" tabindex="-1"></a>| lwage    | num    | log du salaire                     |</span>
<span id="cb94-220"><a href="#cb94-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-221"><a href="#cb94-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercice</span></span>
<span id="cb94-222"><a href="#cb94-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-223"><a href="#cb94-223" aria-hidden="true" tabindex="-1"></a>Nous allons sélectionner un sous-ensemble des 100 ouvriers avec plus de</span>
<span id="cb94-224"><a href="#cb94-224" aria-hidden="true" tabindex="-1"></a>10 ans pour l'expérience et moins de 10 ans pour les études en 1980 et classer le résultat selon le salaire décroissant.La table contiendra les variables suivante: id,sex,exp,ed,lwage.</span>
<span id="cb94-225"><a href="#cb94-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-226"><a href="#cb94-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wages_s,exercise=TRUE,comment="&gt;"}</span></span>
<span id="cb94-227"><a href="#cb94-227" aria-hidden="true" tabindex="-1"></a><span class="in"># 1. Obtenir les informations manquantes</span></span>
<span id="cb94-228"><a href="#cb94-228" aria-hidden="true" tabindex="-1"></a><span class="in">#    -----------------------------------</span></span>
<span id="cb94-229"><a href="#cb94-229" aria-hidden="true" tabindex="-1"></a><span class="in"># Technique manuelle basée sur rep()</span></span>
<span id="cb94-230"><a href="#cb94-230" aria-hidden="true" tabindex="-1"></a><span class="in">head(Wages,7)</span></span>
<span id="cb94-231"><a href="#cb94-231" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_p &lt;- Wages</span></span>
<span id="cb94-232"><a href="#cb94-232" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_p$time &lt;- rep(seq(1:7),595)</span></span>
<span id="cb94-233"><a href="#cb94-233" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_p$id &lt;- rep(1:595,each=7)</span></span>
<span id="cb94-234"><a href="#cb94-234" aria-hidden="true" tabindex="-1"></a><span class="in"># 2. Réaliser le filtre</span></span>
<span id="cb94-235"><a href="#cb94-235" aria-hidden="true" tabindex="-1"></a><span class="in">#    ------------------</span></span>
<span id="cb94-236"><a href="#cb94-236" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_s &lt;- subset(Wages_p, </span></span>
<span id="cb94-237"><a href="#cb94-237" aria-hidden="true" tabindex="-1"></a><span class="in">                  bluecol == "yes" &amp; exp &gt;=10 &amp; ed &lt; 10 &amp; time==5 , </span></span>
<span id="cb94-238"><a href="#cb94-238" aria-hidden="true" tabindex="-1"></a><span class="in">                  select = c(id,sex,exp,ed,lwage))</span></span>
<span id="cb94-239"><a href="#cb94-239" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_s &lt;- head(Wages_s[order(Wages_s$lwage,decreasing=TRUE),],25)</span></span>
<span id="cb94-240"><a href="#cb94-240" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages_s)</span></span>
<span id="cb94-241"><a href="#cb94-241" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_s</span></span>
<span id="cb94-242"><a href="#cb94-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-243"><a href="#cb94-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-244"><a href="#cb94-244" aria-hidden="true" tabindex="-1"></a><span class="fu">## Données externes</span></span>
<span id="cb94-245"><a href="#cb94-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-246"><a href="#cb94-246" aria-hidden="true" tabindex="-1"></a>L'activité la plus régulière en cas d'analyse de données sera de lire et</span>
<span id="cb94-247"><a href="#cb94-247" aria-hidden="true" tabindex="-1"></a>d'écrire des données de ou vers des ressources extérieures à R. Il</span>
<span id="cb94-248"><a href="#cb94-248" aria-hidden="true" tabindex="-1"></a>existe de très nombreux formats possibles. Dans le cadre de ce cours</span>
<span id="cb94-249"><a href="#cb94-249" aria-hidden="true" tabindex="-1"></a>nous allons insister sur les catégories suivantes</span>
<span id="cb94-250"><a href="#cb94-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-251"><a href="#cb94-251" aria-hidden="true" tabindex="-1"></a>| Format        | Caractéristiques     | Exemple           |</span>
<span id="cb94-252"><a href="#cb94-252" aria-hidden="true" tabindex="-1"></a>|---------------|----------------------|-------------------|</span>
<span id="cb94-253"><a href="#cb94-253" aria-hidden="true" tabindex="-1"></a>| Compressées R | I/O uniquement par R | .RData .rda       |</span>
<span id="cb94-254"><a href="#cb94-254" aria-hidden="true" tabindex="-1"></a>| Compressées   | I/O universel        | .parquer .feather |</span>
<span id="cb94-255"><a href="#cb94-255" aria-hidden="true" tabindex="-1"></a>| Textes        | I/O universel        | .csv,...          |</span>
<span id="cb94-256"><a href="#cb94-256" aria-hidden="true" tabindex="-1"></a>| Spécifiques   | I/O spécifique       | .xlsx,...         |</span>
<span id="cb94-257"><a href="#cb94-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-258"><a href="#cb94-258" aria-hidden="true" tabindex="-1"></a>De nombreux packages sont nécessaires pour convertir les différents</span>
<span id="cb94-259"><a href="#cb94-259" aria-hidden="true" tabindex="-1"></a>formats possibles. Un package <span class="in">`rio`</span> regroupe tous ces packages sous une</span>
<span id="cb94-260"><a href="#cb94-260" aria-hidden="true" tabindex="-1"></a>interface commune</span>
<span id="cb94-261"><a href="#cb94-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-262"><a href="#cb94-262" aria-hidden="true" tabindex="-1"></a><span class="fu">### Données Compressés</span></span>
<span id="cb94-263"><a href="#cb94-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-264"><a href="#cb94-264" aria-hidden="true" tabindex="-1"></a>Afin de gagner en efficacité, les données peuvent etre compressés selon un algorithme choisi (zip,...). Nous allons distinguer deux possibiliés, soit les données sont lisibles uniquement par le créateur des données (dans notre cas R), soit les données sont lisibles de manière universelle par un format reconnu nativement au m</span>
<span id="cb94-265"><a href="#cb94-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-266"><a href="#cb94-266" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fichiers propriétaires R: .RData,.rda</span></span>
<span id="cb94-267"><a href="#cb94-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-268"><a href="#cb94-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-269"><a href="#cb94-269" aria-hidden="true" tabindex="-1"></a>Nous examinerons les fichiers suivants:</span>
<span id="cb94-270"><a href="#cb94-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-271"><a href="#cb94-271" aria-hidden="true" tabindex="-1"></a>| Format             | Extension    | Importation (Package) | Exportation (Package) | rio ?   |</span>
<span id="cb94-272"><a href="#cb94-272" aria-hidden="true" tabindex="-1"></a>|---------------|---------------|---------------|---------------|---------------|</span>
<span id="cb94-273"><a href="#cb94-273" aria-hidden="true" tabindex="-1"></a>| R objects (global) | .RData, .rda | **base**              | **base**              | Présent |</span>
<span id="cb94-274"><a href="#cb94-274" aria-hidden="true" tabindex="-1"></a>| R objects (unique) | .rds         | **base**              | **base**              | Présent |</span>
<span id="cb94-275"><a href="#cb94-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-276"><a href="#cb94-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-277"><a href="#cb94-277" aria-hidden="true" tabindex="-1"></a>Il est possible de sauvegarder l'ensemble ou une partie des données</span>
<span id="cb94-278"><a href="#cb94-278" aria-hidden="true" tabindex="-1"></a>définies dans la session de R. Cette sauvegarde se réalise avec les</span>
<span id="cb94-279"><a href="#cb94-279" aria-hidden="true" tabindex="-1"></a>instructions <span class="in">`save()`</span> pour un ensemble d'objets et <span class="in">`save.image()`</span>pour</span>
<span id="cb94-280"><a href="#cb94-280" aria-hidden="true" tabindex="-1"></a>sauvegarder tous les objets.</span>
<span id="cb94-281"><a href="#cb94-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-282"><a href="#cb94-282" aria-hidden="true" tabindex="-1"></a>La lecture se réalise par l'instruction <span class="in">`load()`</span> et se réalise sous la</span>
<span id="cb94-283"><a href="#cb94-283" aria-hidden="true" tabindex="-1"></a>forme d'un fichier binaire. Le format des fichiers est de type binaire</span>
<span id="cb94-284"><a href="#cb94-284" aria-hidden="true" tabindex="-1"></a>et est pas conséquent un fichier propriétaire de R (compressé par R et</span>
<span id="cb94-285"><a href="#cb94-285" aria-hidden="true" tabindex="-1"></a>lisible uniquement par R).</span>
<span id="cb94-286"><a href="#cb94-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-287"><a href="#cb94-287" aria-hidden="true" tabindex="-1"></a>Nous allons expérimenter en créant trois objets en plus des objets</span>
<span id="cb94-288"><a href="#cb94-288" aria-hidden="true" tabindex="-1"></a>existants</span>
<span id="cb94-289"><a href="#cb94-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-290"><a href="#cb94-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r RData,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-291"><a href="#cb94-291" aria-hidden="true" tabindex="-1"></a><span class="in">ls()  # Objets présents</span></span>
<span id="cb94-292"><a href="#cb94-292" aria-hidden="true" tabindex="-1"></a><span class="in">a &lt;- c("Université de Lille")</span></span>
<span id="cb94-293"><a href="#cb94-293" aria-hidden="true" tabindex="-1"></a><span class="in">b &lt;- TRUE</span></span>
<span id="cb94-294"><a href="#cb94-294" aria-hidden="true" tabindex="-1"></a><span class="in">c &lt;- c(10,20,30) # Création de 3 objets</span></span>
<span id="cb94-295"><a href="#cb94-295" aria-hidden="true" tabindex="-1"></a><span class="in">ls()    # Liste des objets</span></span>
<span id="cb94-296"><a href="#cb94-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-297"><a href="#cb94-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-298"><a href="#cb94-298" aria-hidden="true" tabindex="-1"></a>Ensuite nous sauvegardons uniquement les objets a,b et c par</span>
<span id="cb94-299"><a href="#cb94-299" aria-hidden="true" tabindex="-1"></a>l'instruction <span class="in">`save()`</span>. En ensuite nous sauvgardons l'ensemble des</span>
<span id="cb94-300"><a href="#cb94-300" aria-hidden="true" tabindex="-1"></a>objets par l'instruction <span class="in">`save.image()`</span>. Nous vérifions ensuite les</span>
<span id="cb94-301"><a href="#cb94-301" aria-hidden="true" tabindex="-1"></a>tailles des fichiers respectifs par l'instruction <span class="in">`file.info()$size`</span>.</span>
<span id="cb94-302"><a href="#cb94-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-303"><a href="#cb94-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ,comment="&gt;",echo=TRUE,message=FALSE}</span></span>
<span id="cb94-304"><a href="#cb94-304" aria-hidden="true" tabindex="-1"></a><span class="in">save(a,b, file=here("data/Lille.RData"))           </span></span>
<span id="cb94-305"><a href="#cb94-305" aria-hidden="true" tabindex="-1"></a><span class="in"># Sauvegarde de deux objets sur un fichier .Rdata</span></span>
<span id="cb94-306"><a href="#cb94-306" aria-hidden="true" tabindex="-1"></a><span class="in">save.image(file=here("data/Lille_image.RData")) </span></span>
<span id="cb94-307"><a href="#cb94-307" aria-hidden="true" tabindex="-1"></a><span class="in"># Sauvegarde totale sur un fichier .Rdata</span></span>
<span id="cb94-308"><a href="#cb94-308" aria-hidden="true" tabindex="-1"></a><span class="in">file.info(here("data/Lille.RData"))$size           </span></span>
<span id="cb94-309"><a href="#cb94-309" aria-hidden="true" tabindex="-1"></a><span class="in"># Vérification du fichier</span></span>
<span id="cb94-310"><a href="#cb94-310" aria-hidden="true" tabindex="-1"></a><span class="in">file.info(here("data/Lille_image.RData"))$size     </span></span>
<span id="cb94-311"><a href="#cb94-311" aria-hidden="true" tabindex="-1"></a><span class="in"># Vérification du fichier</span></span>
<span id="cb94-312"><a href="#cb94-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-313"><a href="#cb94-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-314"><a href="#cb94-314" aria-hidden="true" tabindex="-1"></a>On vérifie l'opération en retirant les objets et en les rechargeant</span>
<span id="cb94-315"><a href="#cb94-315" aria-hidden="true" tabindex="-1"></a>ensuite.</span>
<span id="cb94-316"><a href="#cb94-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-317"><a href="#cb94-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ,comment="&gt;",echo=TRUE,message=FALSE}</span></span>
<span id="cb94-318"><a href="#cb94-318" aria-hidden="true" tabindex="-1"></a><span class="in">rm(list = c("a","b","c"))               # Suppression de a et b          </span></span>
<span id="cb94-319"><a href="#cb94-319" aria-hidden="true" tabindex="-1"></a><span class="in">ls()                                    # Liste de objets vide</span></span>
<span id="cb94-320"><a href="#cb94-320" aria-hidden="true" tabindex="-1"></a><span class="in">load(file=here("data/Lille.RData")); ls()</span></span>
<span id="cb94-321"><a href="#cb94-321" aria-hidden="true" tabindex="-1"></a><span class="in">load(file=here("data/Lille_image.RData"));ls()</span></span>
<span id="cb94-322"><a href="#cb94-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-323"><a href="#cb94-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-324"><a href="#cb94-324" aria-hidden="true" tabindex="-1"></a>L'avantage unique de ce type de fichier est la capacité de sauvegarder</span>
<span id="cb94-325"><a href="#cb94-325" aria-hidden="true" tabindex="-1"></a>dans un seul fichier l'ensemble des objets peut importe le type.</span>
<span id="cb94-326"><a href="#cb94-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-327"><a href="#cb94-327" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fichiers .rds</span></span>
<span id="cb94-328"><a href="#cb94-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-329"><a href="#cb94-329" aria-hidden="true" tabindex="-1"></a>Le type de fichier .rds est plus limité et seul un objet sera sauvegardé</span>
<span id="cb94-330"><a href="#cb94-330" aria-hidden="true" tabindex="-1"></a>(dataframe, matrice, liste,...). L'écriture se réalise avec <span class="in">`saveRDS()`</span>,</span>
<span id="cb94-331"><a href="#cb94-331" aria-hidden="true" tabindex="-1"></a>l'extension du fichier est .rds. La lecture se réalise avec</span>
<span id="cb94-332"><a href="#cb94-332" aria-hidden="true" tabindex="-1"></a>l'instruction <span class="in">`readRDS`</span>.</span>
<span id="cb94-333"><a href="#cb94-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-334"><a href="#cb94-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r binaire,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-335"><a href="#cb94-335" aria-hidden="true" tabindex="-1"></a><span class="in">data(Wages,package="plm") </span></span>
<span id="cb94-336"><a href="#cb94-336" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(Wages,file=here("data/Wages_binaire.rds"))   # Ecriture fichier binaire</span></span>
<span id="cb94-337"><a href="#cb94-337" aria-hidden="true" tabindex="-1"></a><span class="in">file.info(here("data/Wages_binaire.rds"))$size       # Taille du fichier</span></span>
<span id="cb94-338"><a href="#cb94-338" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_RDS &lt;- readRDS(here("data/Wages_binaire.rds")) # Lecture du fichier</span></span>
<span id="cb94-339"><a href="#cb94-339" aria-hidden="true" tabindex="-1"></a><span class="in">all.equal(Wages_RDS,Wages)                         # Fichiers égaux ?</span></span>
<span id="cb94-340"><a href="#cb94-340" aria-hidden="true" tabindex="-1"></a><span class="in">rm(Wages_RDS)                                      # Effacement données</span></span>
<span id="cb94-341"><a href="#cb94-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-342"><a href="#cb94-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-343"><a href="#cb94-343" aria-hidden="true" tabindex="-1"></a>Nous disposeront également d'une possibilité plus simple de travailler</span>
<span id="cb94-344"><a href="#cb94-344" aria-hidden="true" tabindex="-1"></a>si nous utilisont le package rio, il consiste qui a pour objet</span>
<span id="cb94-345"><a href="#cb94-345" aria-hidden="true" tabindex="-1"></a>d’uniformiser la syntaxe pour les différents formats. Ainsi il suffira</span>
<span id="cb94-346"><a href="#cb94-346" aria-hidden="true" tabindex="-1"></a>simplement d'utiliser la fonction rio::import(nom.extension) pour une</span>
<span id="cb94-347"><a href="#cb94-347" aria-hidden="true" tabindex="-1"></a>importation et rio::export(nom.extension) pour une exportation.</span>
<span id="cb94-348"><a href="#cb94-348" aria-hidden="true" tabindex="-1"></a>L'extension définira la méthode à utiliser. Le package choisit</span>
<span id="cb94-349"><a href="#cb94-349" aria-hidden="true" tabindex="-1"></a>habituellement la fonction existante la plus performante pour réaliser</span>
<span id="cb94-350"><a href="#cb94-350" aria-hidden="true" tabindex="-1"></a>la tâche.</span>
<span id="cb94-351"><a href="#cb94-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-352"><a href="#cb94-352" aria-hidden="true" tabindex="-1"></a>Par exemple, voici une importation et exportation du fichier Wages comme</span>
<span id="cb94-353"><a href="#cb94-353" aria-hidden="true" tabindex="-1"></a>précedemment avec rio:</span>
<span id="cb94-354"><a href="#cb94-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-355"><a href="#cb94-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-356"><a href="#cb94-356" aria-hidden="true" tabindex="-1"></a><span class="in">data(Wages,package="plm") </span></span>
<span id="cb94-357"><a href="#cb94-357" aria-hidden="true" tabindex="-1"></a><span class="in">export(Wages,file=here("data/Wages_rio.rds"))   # Ecriture fichier compressé</span></span>
<span id="cb94-358"><a href="#cb94-358" aria-hidden="true" tabindex="-1"></a><span class="in">file.info(here("data/Wages_rio.rds"))$size      # Taille du fichier</span></span>
<span id="cb94-359"><a href="#cb94-359" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_rio &lt;- import(here("data/Wages_rio.rds")) # Lecture du fichier</span></span>
<span id="cb94-360"><a href="#cb94-360" aria-hidden="true" tabindex="-1"></a><span class="in">all.equal(Wages_rio,Wages)                      # Fichiers égaux ?</span></span>
<span id="cb94-361"><a href="#cb94-361" aria-hidden="true" tabindex="-1"></a><span class="in">rm(Wages_rio)                                   # Effacement données</span></span>
<span id="cb94-362"><a href="#cb94-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-363"><a href="#cb94-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-364"><a href="#cb94-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fichiers compressés universels</span></span>
<span id="cb94-365"><a href="#cb94-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-366"><a href="#cb94-366" aria-hidden="true" tabindex="-1"></a>Dans le cadre de fichiers portables, nous allons nous intéressé à deux</span>
<span id="cb94-367"><a href="#cb94-367" aria-hidden="true" tabindex="-1"></a>formats de fichiers de type colonnes, qui ont l'avantage d'être</span>
<span id="cb94-368"><a href="#cb94-368" aria-hidden="true" tabindex="-1"></a>supportés par de nombreuses plateformes:</span>
<span id="cb94-369"><a href="#cb94-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-370"><a href="#cb94-370" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Le format Feather qui va contenir soit des tables Arrow ou des data</span>
<span id="cb94-371"><a href="#cb94-371" aria-hidden="true" tabindex="-1"></a>    frames de R ou Python. Son usage principal est de permettre un</span>
<span id="cb94-372"><a href="#cb94-372" aria-hidden="true" tabindex="-1"></a>    stockage de données commun à Python et R.</span>
<span id="cb94-373"><a href="#cb94-373" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Le format Parquet qui est un format de type colonne principalement</span>
<span id="cb94-374"><a href="#cb94-374" aria-hidden="true" tabindex="-1"></a>    utilisé pour les problème utilisant les "big data"</span>
<span id="cb94-375"><a href="#cb94-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-376"><a href="#cb94-376" aria-hidden="true" tabindex="-1"></a>https://www.cetic.be/Apache-Parquet-pour-le-stockage-de-donnees-volumineuses</span>
<span id="cb94-377"><a href="#cb94-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-378"><a href="#cb94-378" aria-hidden="true" tabindex="-1"></a>![Exemple de table</span>
<span id="cb94-379"><a href="#cb94-379" aria-hidden="true" tabindex="-1"></a>classique](images/parquet-logique.png){fig-align="center"}</span>
<span id="cb94-380"><a href="#cb94-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-381"><a href="#cb94-381" aria-hidden="true" tabindex="-1"></a>La structure typique d'un fichier csv sera orientée vers les lignes:</span>
<span id="cb94-382"><a href="#cb94-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-383"><a href="#cb94-383" aria-hidden="true" tabindex="-1"></a><span class="al">![Structure en lignes](/images/parquet-row.png)</span>{fig-align="center"}</span>
<span id="cb94-384"><a href="#cb94-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-385"><a href="#cb94-385" aria-hidden="true" tabindex="-1"></a>a structure typique d'un fichier csv sera orientée vers les colonnes:</span>
<span id="cb94-386"><a href="#cb94-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-387"><a href="#cb94-387" aria-hidden="true" tabindex="-1"></a><span class="al">![Structure en colonnes](/images/parquet-col.png)</span>{fig-align="center"}</span>
<span id="cb94-388"><a href="#cb94-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-389"><a href="#cb94-389" aria-hidden="true" tabindex="-1"></a>| Format  | Extension | Importation (Package)                                                        | Exportation (Package)                                 | rio ? |</span>
<span id="cb94-390"><a href="#cb94-390" aria-hidden="true" tabindex="-1"></a>|---------------|---------------|---------------|---------------|---------------|</span>
<span id="cb94-391"><a href="#cb94-391" aria-hidden="true" tabindex="-1"></a>| Feather | .feather  | <span class="co">[</span><span class="ot">**arrow**</span><span class="co">](https://arrow.apache.org/docs/1.0/r/reference/read_parquet.html)</span> | <span class="co">[</span><span class="ot">**arrow**</span><span class="co">](https://cran.r-project.org/package=arrow)</span> | oui   |</span>
<span id="cb94-392"><a href="#cb94-392" aria-hidden="true" tabindex="-1"></a>| Parquet | .parquet  | <span class="co">[</span><span class="ot">**arrow**</span><span class="co">](https://cran.r-project.org/package=arrow)</span>                        | <span class="co">[</span><span class="ot">**arrow**</span><span class="co">](https://cran.r-project.org/package=arrow)</span> | oui   |</span>
<span id="cb94-393"><a href="#cb94-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-394"><a href="#cb94-394" aria-hidden="true" tabindex="-1"></a>Lecture/Ecriture à partir du format Feather</span>
<span id="cb94-395"><a href="#cb94-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-396"><a href="#cb94-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-397"><a href="#cb94-397" aria-hidden="true" tabindex="-1"></a><span class="in"># Ecriture</span></span>
<span id="cb94-398"><a href="#cb94-398" aria-hidden="true" tabindex="-1"></a><span class="in">arrow::write_feather(Wages,here("data/Wages.feather")) # Ecriture des données (.feather)</span></span>
<span id="cb94-399"><a href="#cb94-399" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_feather &lt;- arrow::read_feather(file=here("data/Wages.feather"),</span></span>
<span id="cb94-400"><a href="#cb94-400" aria-hidden="true" tabindex="-1"></a><span class="in">                 col_select=c("exp","bluecol","sex","ed","lwage"))</span></span>
<span id="cb94-401"><a href="#cb94-401" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture des données dans r</span></span>
<span id="cb94-402"><a href="#cb94-402" aria-hidden="true" tabindex="-1"></a><span class="in">head(Wages_feather)   # Affichage des données</span></span>
<span id="cb94-403"><a href="#cb94-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-404"><a href="#cb94-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-405"><a href="#cb94-405" aria-hidden="true" tabindex="-1"></a>Le même exercice sera réalisé à partir de rio</span>
<span id="cb94-406"><a href="#cb94-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-407"><a href="#cb94-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r feather,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-408"><a href="#cb94-408" aria-hidden="true" tabindex="-1"></a><span class="in">rio::export(Wages,here("data/Wages_rio.feather"))</span></span>
<span id="cb94-409"><a href="#cb94-409" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_rio &lt;-  rio::import(here("data/Wages_rio.feather"))</span></span>
<span id="cb94-410"><a href="#cb94-410" aria-hidden="true" tabindex="-1"></a><span class="in">head(Wages_rio)</span></span>
<span id="cb94-411"><a href="#cb94-411" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages_rio,list.lenght=3)</span></span>
<span id="cb94-412"><a href="#cb94-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-413"><a href="#cb94-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-414"><a href="#cb94-414" aria-hidden="true" tabindex="-1"></a>Lecture/Ecriture à partir du format Parquet</span>
<span id="cb94-415"><a href="#cb94-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-416"><a href="#cb94-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-417"><a href="#cb94-417" aria-hidden="true" tabindex="-1"></a><span class="in"># Ecriture</span></span>
<span id="cb94-418"><a href="#cb94-418" aria-hidden="true" tabindex="-1"></a><span class="in">arrow::write_parquet(Wages,here("data/Wages.parquet"))</span></span>
<span id="cb94-419"><a href="#cb94-419" aria-hidden="true" tabindex="-1"></a><span class="in"># Ecriture des données (.parquet)</span></span>
<span id="cb94-420"><a href="#cb94-420" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_parquet &lt;- arrow::read_parquet(</span></span>
<span id="cb94-421"><a href="#cb94-421" aria-hidden="true" tabindex="-1"></a><span class="in">  file=here("data/Wages.parquet"),</span></span>
<span id="cb94-422"><a href="#cb94-422" aria-hidden="true" tabindex="-1"></a><span class="in">  col_select=c("exp","bluecol","sex","ed","lwage"))</span></span>
<span id="cb94-423"><a href="#cb94-423" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture des données dans r</span></span>
<span id="cb94-424"><a href="#cb94-424" aria-hidden="true" tabindex="-1"></a><span class="in">head(Wages_parquet)  # Affichage des données</span></span>
<span id="cb94-425"><a href="#cb94-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-426"><a href="#cb94-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-427"><a href="#cb94-427" aria-hidden="true" tabindex="-1"></a>Le même exercice sera réalisé à partir de rio</span>
<span id="cb94-428"><a href="#cb94-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-429"><a href="#cb94-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wages_python_rio,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-430"><a href="#cb94-430" aria-hidden="true" tabindex="-1"></a><span class="in">rio::export(Wages,here("data/Wages_rio.parquet"))</span></span>
<span id="cb94-431"><a href="#cb94-431" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_rio &lt;-  rio::import(here("data/Wages_rio.parquet"),</span></span>
<span id="cb94-432"><a href="#cb94-432" aria-hidden="true" tabindex="-1"></a><span class="in">              col_select=c("exp","bluecol","sex","ed","lwage"))</span></span>
<span id="cb94-433"><a href="#cb94-433" aria-hidden="true" tabindex="-1"></a><span class="in">head(Wages_rio)</span></span>
<span id="cb94-434"><a href="#cb94-434" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages_rio,list.lenght=3)</span></span>
<span id="cb94-435"><a href="#cb94-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-436"><a href="#cb94-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-437"><a href="#cb94-437" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fichiers textes</span></span>
<span id="cb94-438"><a href="#cb94-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-439"><a href="#cb94-439" aria-hidden="true" tabindex="-1"></a>Les fichiers textes sont simplement des caractères lisible avec les</span>
<span id="cb94-440"><a href="#cb94-440" aria-hidden="true" tabindex="-1"></a>colonnes séparées par un délimiteur. Quatre options sont possibles selon</span>
<span id="cb94-441"><a href="#cb94-441" aria-hidden="true" tabindex="-1"></a>le format du fichier à lire:</span>
<span id="cb94-442"><a href="#cb94-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-443"><a href="#cb94-443" aria-hidden="true" tabindex="-1"></a>| Types | décimal  | délimiteur |</span>
<span id="cb94-444"><a href="#cb94-444" aria-hidden="true" tabindex="-1"></a>|:------|:--------:|-----------:|</span>
<span id="cb94-445"><a href="#cb94-445" aria-hidden="true" tabindex="-1"></a>| delim | locale() |      delim |</span>
<span id="cb94-446"><a href="#cb94-446" aria-hidden="true" tabindex="-1"></a>| csv   |    .     |          , |</span>
<span id="cb94-447"><a href="#cb94-447" aria-hidden="true" tabindex="-1"></a>| csv2  |    ,     |          ; |</span>
<span id="cb94-448"><a href="#cb94-448" aria-hidden="true" tabindex="-1"></a>| tsv   | locale() |        tab |</span>
<span id="cb94-449"><a href="#cb94-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-450"><a href="#cb94-450" aria-hidden="true" tabindex="-1"></a>De nombreuses librairies permettent de lire des données en format texte.</span>
<span id="cb94-451"><a href="#cb94-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-452"><a href="#cb94-452" aria-hidden="true" tabindex="-1"></a>Nous utilisons le fichier binaire ""bigfile.rds". Il s'agit d'un fichier</span>
<span id="cb94-453"><a href="#cb94-453" aria-hidden="true" tabindex="-1"></a>réels de 17872 lignes et 373 variable qui contient du texte et des</span>
<span id="cb94-454"><a href="#cb94-454" aria-hidden="true" tabindex="-1"></a>nombres. Le contenu de ce fichier sera explicité dans la partie</span>
<span id="cb94-455"><a href="#cb94-455" aria-hidden="true" tabindex="-1"></a>consacrée à SAS (nyts).</span>
<span id="cb94-456"><a href="#cb94-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-457"><a href="#cb94-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Create_bigfile_,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-458"><a href="#cb94-458" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture sous dataframe du fichier </span></span>
<span id="cb94-459"><a href="#cb94-459" aria-hidden="true" tabindex="-1"></a><span class="in">bf &lt;- fake_ticket_client(vol=50000,n = 2000,seed = 2811,local = c( "fr_FR"))</span></span>
<span id="cb94-460"><a href="#cb94-460" aria-hidden="true" tabindex="-1"></a><span class="in">str(bf)</span></span>
<span id="cb94-461"><a href="#cb94-461" aria-hidden="true" tabindex="-1"></a><span class="in">length(bf)</span></span>
<span id="cb94-462"><a href="#cb94-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-463"><a href="#cb94-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-464"><a href="#cb94-464" aria-hidden="true" tabindex="-1"></a>On sauvegarde ce fichier sous forme d'un fichier compressé qui nous sera</span>
<span id="cb94-465"><a href="#cb94-465" aria-hidden="true" tabindex="-1"></a>utile poure le suite.</span>
<span id="cb94-466"><a href="#cb94-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-467"><a href="#cb94-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bigfile_RDS,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-468"><a href="#cb94-468" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture sous dataframe du fichierdu fichier </span></span>
<span id="cb94-469"><a href="#cb94-469" aria-hidden="true" tabindex="-1"></a><span class="in">save(bf,file=here("data/bf0.rds"))</span></span>
<span id="cb94-470"><a href="#cb94-470" aria-hidden="true" tabindex="-1"></a><span class="in">file.info(here("data/bf0.rds"))$size      </span></span>
<span id="cb94-471"><a href="#cb94-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-472"><a href="#cb94-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-473"><a href="#cb94-473" aria-hidden="true" tabindex="-1"></a>On remarque la taille fichier qui est de</span>
<span id="cb94-474"><a href="#cb94-474" aria-hidden="true" tabindex="-1"></a><span class="in">`file.info(here("data/bigfile.rds"))$size`</span>. Nous allons écrire ce</span>
<span id="cb94-475"><a href="#cb94-475" aria-hidden="true" tabindex="-1"></a>fichier sous la forme d'un fichier texte. Nous avons le choix entre des</span>
<span id="cb94-476"><a href="#cb94-476" aria-hidden="true" tabindex="-1"></a>fonctions de base et des fonctions proposées par les packages</span>
<span id="cb94-477"><a href="#cb94-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-478"><a href="#cb94-478" aria-hidden="true" tabindex="-1"></a>| Package    | Extension | Importation | Exportation | rio ? |</span>
<span id="cb94-479"><a href="#cb94-479" aria-hidden="true" tabindex="-1"></a>|------------|-----------|-------------|-------------|-------|</span>
<span id="cb94-480"><a href="#cb94-480" aria-hidden="true" tabindex="-1"></a>| Base       | .csv      | read.csv2   | write.csv2  | Non   |</span>
<span id="cb94-481"><a href="#cb94-481" aria-hidden="true" tabindex="-1"></a>| readr      | .csv      | read_csv2   | write_csv2  | Non   |</span>
<span id="cb94-482"><a href="#cb94-482" aria-hidden="true" tabindex="-1"></a>| data.table | .csv      | fread       | fwrite      | Oui   |</span>
<span id="cb94-483"><a href="#cb94-483" aria-hidden="true" tabindex="-1"></a>| vroom      | .csv      | read.csv2   | write.csv2  | Non   |</span>
<span id="cb94-484"><a href="#cb94-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-485"><a href="#cb94-485" aria-hidden="true" tabindex="-1"></a>Ecriture avec les fonctions de base de R soit <span class="in">`write.csv2`</span> et</span>
<span id="cb94-486"><a href="#cb94-486" aria-hidden="true" tabindex="-1"></a><span class="in">`read.csv2`</span>. Nous adoptons la version francophone de CSV soit CSV2 avec</span>
<span id="cb94-487"><a href="#cb94-487" aria-hidden="true" tabindex="-1"></a>des colonnes séparées par des points virgules et le délimiteur décimal</span>
<span id="cb94-488"><a href="#cb94-488" aria-hidden="true" tabindex="-1"></a>est la virgule</span>
<span id="cb94-489"><a href="#cb94-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-490"><a href="#cb94-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r benchmark_write,exercise=TRUE,comment="&gt;",echo=TRUE,warning=FALSE,cache=TRUE}</span></span>
<span id="cb94-491"><a href="#cb94-491" aria-hidden="true" tabindex="-1"></a><span class="in">benchmark(write.csv2=write.csv2(bf,here("data/bf1.csv")),</span></span>
<span id="cb94-492"><a href="#cb94-492" aria-hidden="true" tabindex="-1"></a><span class="in">          readr_write_csv=readr::write_csv2(bf,here("data/bf2.csv")),</span></span>
<span id="cb94-493"><a href="#cb94-493" aria-hidden="true" tabindex="-1"></a><span class="in">          data.table_fwrite=data.table::fwrite(bf,here("data/bf3.csv")),</span></span>
<span id="cb94-494"><a href="#cb94-494" aria-hidden="true" tabindex="-1"></a><span class="in">          rio_export=rio::export(bf,here("data/bf4.csv")),</span></span>
<span id="cb94-495"><a href="#cb94-495" aria-hidden="true" tabindex="-1"></a><span class="in">          vroom_vroom_write=vroom::vroom_write(bf,here("data/bf5.csv")),   </span></span>
<span id="cb94-496"><a href="#cb94-496" aria-hidden="true" tabindex="-1"></a><span class="in">          replications=1,</span></span>
<span id="cb94-497"><a href="#cb94-497" aria-hidden="true" tabindex="-1"></a><span class="in">              columns=c('test','user.self','sys.self', 'elapsed', 'replications'),</span></span>
<span id="cb94-498"><a href="#cb94-498" aria-hidden="true" tabindex="-1"></a><span class="in">              order=NULL</span></span>
<span id="cb94-499"><a href="#cb94-499" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb94-500"><a href="#cb94-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-501"><a href="#cb94-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-502"><a href="#cb94-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r taille_csv,exercise=TRUE,comment="&gt;",echo=TRUE,message=FALSE}</span></span>
<span id="cb94-503"><a href="#cb94-503" aria-hidden="true" tabindex="-1"></a><span class="in">fichiers_liste &lt;- paste0("data/bf", 1:5, ".csv")</span></span>
<span id="cb94-504"><a href="#cb94-504" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size &lt;- data.frame(Fichiers=fichiers_liste)</span></span>
<span id="cb94-505"><a href="#cb94-505" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size$Fonction &lt;- c("base csv","readr","data.table","rio","vroom")</span></span>
<span id="cb94-506"><a href="#cb94-506" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size$Taille &lt;- file.size(bench_size$Fichiers)</span></span>
<span id="cb94-507"><a href="#cb94-507" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size</span></span>
<span id="cb94-508"><a href="#cb94-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-509"><a href="#cb94-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-510"><a href="#cb94-510" aria-hidden="true" tabindex="-1"></a>La taille des fichiers est relativement similaire avec les différents</span>
<span id="cb94-511"><a href="#cb94-511" aria-hidden="true" tabindex="-1"></a>formats de fichiers texte. Cependant le temps d'écriture et de lecture</span>
<span id="cb94-512"><a href="#cb94-512" aria-hidden="true" tabindex="-1"></a>est fort variable. Nous utilisons la fonction <span class="in">`system.time()`</span> pour</span>
<span id="cb94-513"><a href="#cb94-513" aria-hidden="true" tabindex="-1"></a>mesurer le temps écoulé.</span>
<span id="cb94-514"><a href="#cb94-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-515"><a href="#cb94-515" aria-hidden="true" tabindex="-1"></a>Pour la lecture:</span>
<span id="cb94-516"><a href="#cb94-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-517"><a href="#cb94-517" aria-hidden="true" tabindex="-1"></a>les performance sont variables avec la fonction vroom() qui est toujours</span>
<span id="cb94-518"><a href="#cb94-518" aria-hidden="true" tabindex="-1"></a>la plus rapide data.table est le plus rapide</span>
<span id="cb94-519"><a href="#cb94-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-520"><a href="#cb94-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r benchmark_read,exercise=TRUE,comment="&gt;",echo=TRUE,warning=FALSE,cache=TRUE}</span></span>
<span id="cb94-521"><a href="#cb94-521" aria-hidden="true" tabindex="-1"></a><span class="in">benchmark(read.csv2=read.csv2(here("data/bf1.csv")),</span></span>
<span id="cb94-522"><a href="#cb94-522" aria-hidden="true" tabindex="-1"></a><span class="in">          readr_read_csv=readr::read_csv(here("data/bf2.csv"),show_col_types = FALSE),</span></span>
<span id="cb94-523"><a href="#cb94-523" aria-hidden="true" tabindex="-1"></a><span class="in">          data.table_fread=data.table::fread(here("data/bf3.csv")),</span></span>
<span id="cb94-524"><a href="#cb94-524" aria-hidden="true" tabindex="-1"></a><span class="in">          rio_import=rio::import(here("data/bf4.csv")),</span></span>
<span id="cb94-525"><a href="#cb94-525" aria-hidden="true" tabindex="-1"></a><span class="in">          vroom_vroom=vroom::vroom(here("data/bf5.csv"),show_col_types = FALSE),        </span></span>
<span id="cb94-526"><a href="#cb94-526" aria-hidden="true" tabindex="-1"></a><span class="in">          replications=1,</span></span>
<span id="cb94-527"><a href="#cb94-527" aria-hidden="true" tabindex="-1"></a><span class="in">              columns=c('test','user.self','sys.self', 'elapsed', 'replications'),</span></span>
<span id="cb94-528"><a href="#cb94-528" aria-hidden="true" tabindex="-1"></a><span class="in">              order=NULL</span></span>
<span id="cb94-529"><a href="#cb94-529" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb94-530"><a href="#cb94-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-531"><a href="#cb94-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-532"><a href="#cb94-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-533"><a href="#cb94-533" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparaison fichiers textes et compressés</span></span>
<span id="cb94-534"><a href="#cb94-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-535"><a href="#cb94-535" aria-hidden="true" tabindex="-1"></a>Nous allon comparer le format csv le plus performant (vromm) avec les</span>
<span id="cb94-536"><a href="#cb94-536" aria-hidden="true" tabindex="-1"></a>formats compressés (rds, feather et parquet)</span>
<span id="cb94-537"><a href="#cb94-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-538"><a href="#cb94-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r benchmark_2_write,exercise=TRUE,comment="&gt;",echo=TRUE,warning=FALSE,cache=TRUE}</span></span>
<span id="cb94-539"><a href="#cb94-539" aria-hidden="true" tabindex="-1"></a><span class="in">benchmark(csv=vroom::vroom_write(bf,here("data/bf.csv")) ,</span></span>
<span id="cb94-540"><a href="#cb94-540" aria-hidden="true" tabindex="-1"></a><span class="in">          rds=export(bf,here("data/bf.rds")) ,</span></span>
<span id="cb94-541"><a href="#cb94-541" aria-hidden="true" tabindex="-1"></a><span class="in">          feather=export(bf,here("data/bf.feather")) ,</span></span>
<span id="cb94-542"><a href="#cb94-542" aria-hidden="true" tabindex="-1"></a><span class="in">          parquet=export(bf,here("data/bf.parquet")), </span></span>
<span id="cb94-543"><a href="#cb94-543" aria-hidden="true" tabindex="-1"></a><span class="in">          replications=1,</span></span>
<span id="cb94-544"><a href="#cb94-544" aria-hidden="true" tabindex="-1"></a><span class="in">              columns=c('test','user.self','sys.self', 'elapsed', 'replications'),</span></span>
<span id="cb94-545"><a href="#cb94-545" aria-hidden="true" tabindex="-1"></a><span class="in">              order=NULL</span></span>
<span id="cb94-546"><a href="#cb94-546" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb94-547"><a href="#cb94-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-548"><a href="#cb94-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-549"><a href="#cb94-549" aria-hidden="true" tabindex="-1"></a>On constate en écriture que le fichier **rds** est le plus lent suivi du **csv**</span>
<span id="cb94-550"><a href="#cb94-550" aria-hidden="true" tabindex="-1"></a>, les autres formats sont proches, le plus rapide est clairement **feather**</span>
<span id="cb94-551"><a href="#cb94-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-552"><a href="#cb94-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bench_size_c,exercise=TRUE,comment="&gt;",echo=TRUE,mesage=FALSE}</span></span>
<span id="cb94-553"><a href="#cb94-553" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size &lt;- data.frame(Fichiers=c("data/bf.csv",</span></span>
<span id="cb94-554"><a href="#cb94-554" aria-hidden="true" tabindex="-1"></a><span class="in">                 "data/bf.feather",</span></span>
<span id="cb94-555"><a href="#cb94-555" aria-hidden="true" tabindex="-1"></a><span class="in">                 "data/bf.rds",</span></span>
<span id="cb94-556"><a href="#cb94-556" aria-hidden="true" tabindex="-1"></a><span class="in">                 "data/bf.parquet"))</span></span>
<span id="cb94-557"><a href="#cb94-557" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size$Fonction &lt;- c("vroom","arrow feather","rds","arrow parquet")</span></span>
<span id="cb94-558"><a href="#cb94-558" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size$Taille &lt;- file.size(bench_size$Fichiers)</span></span>
<span id="cb94-559"><a href="#cb94-559" aria-hidden="true" tabindex="-1"></a><span class="in">bench_size</span></span>
<span id="cb94-560"><a href="#cb94-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-561"><a href="#cb94-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-562"><a href="#cb94-562" aria-hidden="true" tabindex="-1"></a>On constate pour les tailles que le fichier **csv** est le plus imposant</span>
<span id="cb94-563"><a href="#cb94-563" aria-hidden="true" tabindex="-1"></a>suivi du format **feather**, les autres format sont nettement plus compressés, le plus léger</span>
<span id="cb94-564"><a href="#cb94-564" aria-hidden="true" tabindex="-1"></a>est **parquet**</span>
<span id="cb94-565"><a href="#cb94-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-566"><a href="#cb94-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r benchmark_2_read,exercise=TRUE,comment="&gt;",echo=TRUE,warning=FALSE,cache=TRUE}</span></span>
<span id="cb94-567"><a href="#cb94-567" aria-hidden="true" tabindex="-1"></a><span class="in">benchmark(vroom_csv=import(here("data/bf.csv")) ,</span></span>
<span id="cb94-568"><a href="#cb94-568" aria-hidden="true" tabindex="-1"></a><span class="in">          rds=import(here("data/bf.rds")) ,</span></span>
<span id="cb94-569"><a href="#cb94-569" aria-hidden="true" tabindex="-1"></a><span class="in">          feather=import(here("data/bf.feather")) ,</span></span>
<span id="cb94-570"><a href="#cb94-570" aria-hidden="true" tabindex="-1"></a><span class="in">          parquet=import(here("data/bf.parquet")), </span></span>
<span id="cb94-571"><a href="#cb94-571" aria-hidden="true" tabindex="-1"></a><span class="in">          replications=1,</span></span>
<span id="cb94-572"><a href="#cb94-572" aria-hidden="true" tabindex="-1"></a><span class="in">              columns=c('test','user.self','sys.self', 'elapsed', 'replications'),</span></span>
<span id="cb94-573"><a href="#cb94-573" aria-hidden="true" tabindex="-1"></a><span class="in">              order=NULL</span></span>
<span id="cb94-574"><a href="#cb94-574" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb94-575"><a href="#cb94-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-576"><a href="#cb94-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-577"><a href="#cb94-577" aria-hidden="true" tabindex="-1"></a>On constate en lecture que le fichier **rds** est le plus lent suivi du **csv**</span>
<span id="cb94-578"><a href="#cb94-578" aria-hidden="true" tabindex="-1"></a>, les autres formats sont les plus rapides.</span>
<span id="cb94-579"><a href="#cb94-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-580"><a href="#cb94-580" aria-hidden="true" tabindex="-1"></a>La différence entre le binaire et le csv sera la taille et la vitesse de</span>
<span id="cb94-581"><a href="#cb94-581" aria-hidden="true" tabindex="-1"></a>lecture</span>
<span id="cb94-582"><a href="#cb94-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-583"><a href="#cb94-583" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Si on travaille sur de petits fichiers cela n'a pas d'importance.</span>
<span id="cb94-584"><a href="#cb94-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-585"><a href="#cb94-585" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sur de gros fichiers, les avantages en terme de taille et de vitesse</span>
<span id="cb94-586"><a href="#cb94-586" aria-hidden="true" tabindex="-1"></a>    sont importants pour les fichiers compressés. Les fichiers</span>
<span id="cb94-587"><a href="#cb94-587" aria-hidden="true" tabindex="-1"></a>    universels sont plus efficaces en taille et en vitesse. Le format</span>
<span id="cb94-588"><a href="#cb94-588" aria-hidden="true" tabindex="-1"></a>    feather est à privilégier en vitesse et le format parquet est</span>
<span id="cb94-589"><a href="#cb94-589" aria-hidden="true" tabindex="-1"></a>    efficace en taille.</span>
<span id="cb94-590"><a href="#cb94-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-591"><a href="#cb94-591" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fichiers de tableurs (.xls,.xlsx)</span></span>
<span id="cb94-592"><a href="#cb94-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-593"><a href="#cb94-593" aria-hidden="true" tabindex="-1"></a>Le format tableur est souvent utile pour transmettre ou recevoir des</span>
<span id="cb94-594"><a href="#cb94-594" aria-hidden="true" tabindex="-1"></a>données. Deux formats sont possibles soit le format ancien (.xls) ou le</span>
<span id="cb94-595"><a href="#cb94-595" aria-hidden="true" tabindex="-1"></a>format actual (.xlsx). Pour lire un format ancien, <span class="in">`readxl`</span> est le plus</span>
<span id="cb94-596"><a href="#cb94-596" aria-hidden="true" tabindex="-1"></a>adapté.. Si nous travaillons avec des formats plus modernes, le package</span>
<span id="cb94-597"><a href="#cb94-597" aria-hidden="true" tabindex="-1"></a><span class="in">`openxlsx`</span> est mieux adapté et beaucoup plus flexible pour le formatage</span>
<span id="cb94-598"><a href="#cb94-598" aria-hidden="true" tabindex="-1"></a>des données. Le package <span class="in">`rio`</span> simplifie l'usage de ce package au prix</span>
<span id="cb94-599"><a href="#cb94-599" aria-hidden="true" tabindex="-1"></a>d'une flexibilité plus faible</span>
<span id="cb94-600"><a href="#cb94-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-601"><a href="#cb94-601" aria-hidden="true" tabindex="-1"></a>| Format | Extension | Importation (Package)                                     | Exportation (Package)                                       | rio ? |</span>
<span id="cb94-602"><a href="#cb94-602" aria-hidden="true" tabindex="-1"></a>|:--------------|:--------------|:--------------|:--------------|:--------------|</span>
<span id="cb94-603"><a href="#cb94-603" aria-hidden="true" tabindex="-1"></a>| Excel  | .xls      | <span class="co">[</span><span class="ot">**readxl**</span><span class="co">](https://cran.r-project.org/package=readxl)</span>   | non                                                         | non   |</span>
<span id="cb94-604"><a href="#cb94-604" aria-hidden="true" tabindex="-1"></a>| Excel  | .xlsx     | <span class="co">[</span><span class="ot">**openxlsx**</span><span class="co">](https://cran.r-project.org/package=readxl)</span> | <span class="co">[</span><span class="ot">**openxlsx**</span><span class="co">](https://cran.r-project.org/package=openxlsx)</span> | Oui   |</span>
<span id="cb94-605"><a href="#cb94-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-606"><a href="#cb94-606" aria-hidden="true" tabindex="-1"></a>Nous reprenons les données sur les salaires pour illustrer les</span>
<span id="cb94-607"><a href="#cb94-607" aria-hidden="true" tabindex="-1"></a>opérations: L'objectif sera de séparer la base de données en deux</span>
<span id="cb94-608"><a href="#cb94-608" aria-hidden="true" tabindex="-1"></a>groupes (hommes et femmes) et d'écrire les bases dans deux feuilles</span>
<span id="cb94-609"><a href="#cb94-609" aria-hidden="true" tabindex="-1"></a>séparées d'un classeur</span>
<span id="cb94-610"><a href="#cb94-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-611"><a href="#cb94-611" aria-hidden="true" tabindex="-1"></a>On commence par séparer les deux groupes :</span>
<span id="cb94-612"><a href="#cb94-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-613"><a href="#cb94-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r xlsx_data,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-614"><a href="#cb94-614" aria-hidden="true" tabindex="-1"></a><span class="in">data(Wages)</span></span>
<span id="cb94-615"><a href="#cb94-615" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_m &lt;- Wages[Wages$sex=="male",]            # Sélection des hommes</span></span>
<span id="cb94-616"><a href="#cb94-616" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_f &lt;- Wages[Wages$sex=="female",]          # Sélection des femmes</span></span>
<span id="cb94-617"><a href="#cb94-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-618"><a href="#cb94-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-619"><a href="#cb94-619" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb94-620"><a href="#cb94-620" aria-hidden="true" tabindex="-1"></a>L'écriture <span class="in">`Wages[sex=="male",]`</span> n'est pas valable car le nom <span class="in">`sex`</span></span>
<span id="cb94-621"><a href="#cb94-621" aria-hidden="true" tabindex="-1"></a>n'est pas défini auparavant</span>
<span id="cb94-622"><a href="#cb94-622" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb94-623"><a href="#cb94-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-624"><a href="#cb94-624" aria-hidden="true" tabindex="-1"></a>Par exemple nous écrivons dans le nouveau format avec</span>
<span id="cb94-625"><a href="#cb94-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-626"><a href="#cb94-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r xlsx_write,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-627"><a href="#cb94-627" aria-hidden="true" tabindex="-1"></a><span class="in"># Exriture des données</span></span>
<span id="cb94-628"><a href="#cb94-628" aria-hidden="true" tabindex="-1"></a><span class="in">wb &lt;- openxlsx::createWorkbook(title="Wages_split")             # Création du tableur vide </span></span>
<span id="cb94-629"><a href="#cb94-629" aria-hidden="true" tabindex="-1"></a><span class="in">openxlsx::addWorksheet(wb,"Wage_M_s")</span></span>
<span id="cb94-630"><a href="#cb94-630" aria-hidden="true" tabindex="-1"></a><span class="in">openxlsx::addWorksheet(wb,"Wage_F_s")</span></span>
<span id="cb94-631"><a href="#cb94-631" aria-hidden="true" tabindex="-1"></a><span class="in">openxlsx::writeData(wb, "Wage_M_s", Wages_m,</span></span>
<span id="cb94-632"><a href="#cb94-632" aria-hidden="true" tabindex="-1"></a><span class="in">  rowNames = TRUE, startCol = "C", startRow = 3,</span></span>
<span id="cb94-633"><a href="#cb94-633" aria-hidden="true" tabindex="-1"></a><span class="in">  borders = "surrounding", borderColour = "black")</span></span>
<span id="cb94-634"><a href="#cb94-634" aria-hidden="true" tabindex="-1"></a><span class="in">openxlsx::writeData(wb, "Wage_F_s", Wages_f,</span></span>
<span id="cb94-635"><a href="#cb94-635" aria-hidden="true" tabindex="-1"></a><span class="in">  rowNames = TRUE, startCol = "C", startRow = 3,</span></span>
<span id="cb94-636"><a href="#cb94-636" aria-hidden="true" tabindex="-1"></a><span class="in">  borders = "surrounding", borderColour = "red")</span></span>
<span id="cb94-637"><a href="#cb94-637" aria-hidden="true" tabindex="-1"></a><span class="in">openxlsx::saveWorkbook(wb, file = "data/Wages.xlsx", </span></span>
<span id="cb94-638"><a href="#cb94-638" aria-hidden="true" tabindex="-1"></a><span class="in">             overwrite = TRUE)</span></span>
<span id="cb94-639"><a href="#cb94-639" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture des données</span></span>
<span id="cb94-640"><a href="#cb94-640" aria-hidden="true" tabindex="-1"></a><span class="in">Wage_M_s &lt;- openxlsx::readWorkbook(xlsxFile = here("data/Wages.xlsx"),sheet="Wage_M_s")</span></span>
<span id="cb94-641"><a href="#cb94-641" aria-hidden="true" tabindex="-1"></a><span class="in">Wage_F_s &lt;- openxlsx::readWorkbook(xlsxFile = here("data/Wages.xlsx"),sheet="Wage_F_s")</span></span>
<span id="cb94-642"><a href="#cb94-642" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wage_M_s)</span></span>
<span id="cb94-643"><a href="#cb94-643" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wage_F_s)</span></span>
<span id="cb94-644"><a href="#cb94-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-645"><a href="#cb94-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-646"><a href="#cb94-646" aria-hidden="true" tabindex="-1"></a>La même opération avec <span class="in">`rio`</span>, beaucoup plus compact mais moins flexible</span>
<span id="cb94-647"><a href="#cb94-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-648"><a href="#cb94-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r xlsx_rio,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-649"><a href="#cb94-649" aria-hidden="true" tabindex="-1"></a><span class="in"># Ecriture</span></span>
<span id="cb94-650"><a href="#cb94-650" aria-hidden="true" tabindex="-1"></a><span class="in">rio::export(list(Wage_M_s = Wages_m, Wage_F_s = Wages_f), file="data/Wages.xlsx",overwrite=TRUE)</span></span>
<span id="cb94-651"><a href="#cb94-651" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture</span></span>
<span id="cb94-652"><a href="#cb94-652" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_i &lt;- rio::import_list(which=c("Wage_M_s","Wage_F_s"),file="data/Wages.xlsx")</span></span>
<span id="cb94-653"><a href="#cb94-653" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages_i$Wage_M_s)</span></span>
<span id="cb94-654"><a href="#cb94-654" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages_i$Wage_F_s)</span></span>
<span id="cb94-655"><a href="#cb94-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-656"><a href="#cb94-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-657"><a href="#cb94-657" aria-hidden="true" tabindex="-1"></a>Utilisation du format ancien</span>
<span id="cb94-658"><a href="#cb94-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-659"><a href="#cb94-659" aria-hidden="true" tabindex="-1"></a>Opération inverse de récupération des données:</span>
<span id="cb94-660"><a href="#cb94-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-661"><a href="#cb94-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r xls_readxl,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-662"><a href="#cb94-662" aria-hidden="true" tabindex="-1"></a><span class="in"># Lecture </span></span>
<span id="cb94-663"><a href="#cb94-663" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_m &lt;- readxl::read_xls(here("data/Wages.xls"),sheet="Wage_M_s")</span></span>
<span id="cb94-664"><a href="#cb94-664" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_f &lt;- readxl::read_xls(here("data/Wages.xls"),sheet="Wage_F_s")</span></span>
<span id="cb94-665"><a href="#cb94-665" aria-hidden="true" tabindex="-1"></a><span class="in">Wages_xls &lt;- rbind(Wages_m,Wages_f)                 # recréation des données</span></span>
<span id="cb94-666"><a href="#cb94-666" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages)                                  # Vérification</span></span>
<span id="cb94-667"><a href="#cb94-667" aria-hidden="true" tabindex="-1"></a><span class="in">str(Wages_xls)                                  # Vérification</span></span>
<span id="cb94-668"><a href="#cb94-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-669"><a href="#cb94-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-670"><a href="#cb94-670" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compatibilité SAS,SPSS et Stata</span></span>
<span id="cb94-671"><a href="#cb94-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-672"><a href="#cb94-672" aria-hidden="true" tabindex="-1"></a>Pour ces formats particuliers , nous avons deux options soit utiliser le</span>
<span id="cb94-673"><a href="#cb94-673" aria-hidden="true" tabindex="-1"></a>package ***heaven*** soit le package ***rio***</span>
<span id="cb94-674"><a href="#cb94-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-675"><a href="#cb94-675" aria-hidden="true" tabindex="-1"></a>| Format            | Extension | Importation                                                          | Exportation                                                           | rio ? |</span>
<span id="cb94-676"><a href="#cb94-676" aria-hidden="true" tabindex="-1"></a>|---------------|---------------|---------------|---------------|---------------|</span>
<span id="cb94-677"><a href="#cb94-677" aria-hidden="true" tabindex="-1"></a>| SAS               | .sas7bdat | <span class="co">[</span><span class="ot">**read_sas**</span><span class="co">](https://haven.tidyverse.org/reference/read_sas.html)</span>  | <span class="co">[</span><span class="ot">**write_sas**</span><span class="co">](https://haven.tidyverse.org/reference/write_sas.html)</span> | Oui   |</span>
<span id="cb94-678"><a href="#cb94-678" aria-hidden="true" tabindex="-1"></a>| SAS XPORT         | .xpt      | <span class="co">[</span><span class="ot">**read_xpt**</span><span class="co">](https://haven.tidyverse.org/reference/read_xpt.html)</span>  | <span class="co">[</span><span class="ot">**write_xpt**</span><span class="co">](https://haven.tidyverse.org/reference/read_xpt.html)</span>  | Oui   |</span>
<span id="cb94-679"><a href="#cb94-679" aria-hidden="true" tabindex="-1"></a>| SPSS              | .sav      | <span class="co">[</span><span class="ot">**read_sav**</span><span class="co">](https://haven.tidyverse.org/reference/read_spss.html)</span> | <span class="co">[</span><span class="ot">**write_sav**</span><span class="co">](https://haven.tidyverse.org/reference/read_spss.html)</span> | Oui   |</span>
<span id="cb94-680"><a href="#cb94-680" aria-hidden="true" tabindex="-1"></a>| SPSS (compressed) | .zsav     | <span class="co">[</span><span class="ot">**read_sav**</span><span class="co">](https://haven.tidyverse.org/reference/read_sav.html)</span>  | <span class="co">[</span><span class="ot">**write_sav**</span><span class="co">](https://haven.tidyverse.org/reference/read_sav.html)</span>  | Oui   |</span>
<span id="cb94-681"><a href="#cb94-681" aria-hidden="true" tabindex="-1"></a>| SPSS Portable     | .por      | <span class="co">[</span><span class="ot">**read_por**</span><span class="co">](https://haven.tidyverse.org/reference/read_spss.html)</span> |                                                                       | Oui   |</span>
<span id="cb94-682"><a href="#cb94-682" aria-hidden="true" tabindex="-1"></a>| Stata             | .dta      | <span class="co">[</span><span class="ot">**read_dta**</span><span class="co">](https://haven.tidyverse.org/reference/read_dta.html)</span>  | <span class="co">[</span><span class="ot">**write_dta**</span><span class="co">](https://haven.tidyverse.org/reference/read_dta.html)</span>  | Oui   |</span>
<span id="cb94-683"><a href="#cb94-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-684"><a href="#cb94-684" aria-hidden="true" tabindex="-1"></a>On dispose sur le www de nombreux fichiers au format sas qui comportent</span>
<span id="cb94-685"><a href="#cb94-685" aria-hidden="true" tabindex="-1"></a>souvent des informations fort détaillées sur les données. Les fichiers</span>
<span id="cb94-686"><a href="#cb94-686" aria-hidden="true" tabindex="-1"></a>sur les enquêtes ou sondages sont souvent de cette nature. Nous prenons</span>
<span id="cb94-687"><a href="#cb94-687" aria-hidden="true" tabindex="-1"></a>comme exemple l'enquête nyts (National Youth Tabacco Survey) du CDC</span>
<span id="cb94-688"><a href="#cb94-688" aria-hidden="true" tabindex="-1"></a>(Center for Diseases control and prevention) voir:</span>
<span id="cb94-689"><a href="#cb94-689" aria-hidden="true" tabindex="-1"></a>https://www.cdc.gov/tobacco/data_statistics/surveys/nyts/index.html.</span>
<span id="cb94-690"><a href="#cb94-690" aria-hidden="true" tabindex="-1"></a>Base de donnée de sondage typique avec 17872 personnes interrogées</span>
<span id="cb94-691"><a href="#cb94-691" aria-hidden="true" tabindex="-1"></a>répondant à 373 questions.</span>
<span id="cb94-692"><a href="#cb94-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-693"><a href="#cb94-693" aria-hidden="true" tabindex="-1"></a>Les fichiers se composent de deux parties, une partie pour les données</span>
<span id="cb94-694"><a href="#cb94-694" aria-hidden="true" tabindex="-1"></a>(extension .sas7bdat) et une partie pour le format (extension</span>
<span id="cb94-695"><a href="#cb94-695" aria-hidden="true" tabindex="-1"></a>.sas7bcat). Le package <span class="sc">\`</span>haven' nous permet de lire facilement ces</span>
<span id="cb94-696"><a href="#cb94-696" aria-hidden="true" tabindex="-1"></a>données et de récupérer l'information (certaines opérations</span>
<span id="cb94-697"><a href="#cb94-697" aria-hidden="true" tabindex="-1"></a>complémentaires seront parfois nécessaires).</span>
<span id="cb94-698"><a href="#cb94-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-699"><a href="#cb94-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sas,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-700"><a href="#cb94-700" aria-hidden="true" tabindex="-1"></a><span class="in">nyts &lt;- haven::read_sas(data_file    = here("data/nyts2017.sas7bdat"),</span></span>
<span id="cb94-701"><a href="#cb94-701" aria-hidden="true" tabindex="-1"></a><span class="in">                 catalog_file = here("data/formats.sas7bcat"))</span></span>
<span id="cb94-702"><a href="#cb94-702" aria-hidden="true" tabindex="-1"></a><span class="in">nyts[1:10,1:3]</span></span>
<span id="cb94-703"><a href="#cb94-703" aria-hidden="true" tabindex="-1"></a><span class="in">rio::export(nyts,here("data/nyts.rds"))</span></span>
<span id="cb94-704"><a href="#cb94-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-705"><a href="#cb94-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-706"><a href="#cb94-706" aria-hidden="true" tabindex="-1"></a>Il est possible d'utiliser <span class="in">`rio`</span> pour lire les données (pas le</span>
<span id="cb94-707"><a href="#cb94-707" aria-hidden="true" tabindex="-1"></a>catalogue)</span>
<span id="cb94-708"><a href="#cb94-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-709"><a href="#cb94-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sas_rio,exercise=TRUE,comment="&gt;",echo=TRUE}</span></span>
<span id="cb94-710"><a href="#cb94-710" aria-hidden="true" tabindex="-1"></a><span class="in">nyts &lt;- rio::import(file    = here("data/nyts2017.sas7bdat"))</span></span>
<span id="cb94-711"><a href="#cb94-711" aria-hidden="true" tabindex="-1"></a><span class="in">nyts[1:10,1:3]</span></span>
<span id="cb94-712"><a href="#cb94-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-713"><a href="#cb94-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-714"><a href="#cb94-714" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Exercice --&gt;</span></span>
<span id="cb94-715"><a href="#cb94-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-716"><a href="#cb94-716" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- En utilisant le set de données ”Males” du package plm: --&gt;</span></span>
<span id="cb94-717"><a href="#cb94-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-718"><a href="#cb94-718" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - Créez un fichier binaire contenant tous les travailleurs mariés de 85 et 86. --&gt;</span></span>
<span id="cb94-719"><a href="#cb94-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-720"><a href="#cb94-720" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - Créez une feuille Excel avec tous les travailleurs affiliés à un syndicat (union). --&gt;</span></span>
<span id="cb94-721"><a href="#cb94-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-722"><a href="#cb94-722" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Lisez les fichiers ”fichier1.txt" à fichier4.txt” dans R. --&gt;</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>